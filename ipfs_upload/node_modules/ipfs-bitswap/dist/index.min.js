(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.IpfsBitswap = factory()}(typeof self !== 'undefined' ? self : this, function () {
var IpfsBitswap=(()=>{var Sc=Object.create;var gt=Object.defineProperty;var Cc=Object.getOwnPropertyDescriptor;var Tc=Object.getOwnPropertyNames;var Fc=Object.getPrototypeOf,Oc=Object.prototype.hasOwnProperty;var on=r=>gt(r,"__esModule",{value:!0});var z=(r,e)=>()=>(r&&(e=r(r=0)),e);var g=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),X=(r,e)=>{on(r);for(var t in e)gt(r,t,{get:e[t],enumerable:!0})},Mc=(r,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Tc(e))!Oc.call(r,n)&&n!=="default"&&gt(r,n,{get:()=>e[n],enumerable:!(t=Cc(e,n))||t.enumerable});return r},an=r=>Mc(on(gt(r!=null?Sc(Fc(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var un=g(wt=>{u();"use strict";wt.byteLength=Pc;wt.toByteArray=qc;wt.fromByteArray=Rc;var Z=[],V=[],Lc=typeof Uint8Array!="undefined"?Uint8Array:Array,Jt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Pe=0,Ic=Jt.length;Pe<Ic;++Pe)Z[Pe]=Jt[Pe],V[Jt.charCodeAt(Pe)]=Pe;V["-".charCodeAt(0)]=62;V["_".charCodeAt(0)]=63;function cn(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function Pc(r){var e=cn(r),t=e[0],n=e[1];return(t+n)*3/4-n}function Dc(r,e,t){return(e+t)*3/4-t}function qc(r){var e,t=cn(r),n=t[0],i=t[1],s=new Lc(Dc(r,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=V[r.charCodeAt(c)]<<18|V[r.charCodeAt(c+1)]<<12|V[r.charCodeAt(c+2)]<<6|V[r.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=V[r.charCodeAt(c)]<<2|V[r.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=V[r.charCodeAt(c)]<<10|V[r.charCodeAt(c+1)]<<4|V[r.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function Nc(r){return Z[r>>18&63]+Z[r>>12&63]+Z[r>>6&63]+Z[r&63]}function Uc(r,e,t){for(var n,i=[],s=e;s<t;s+=3)n=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),i.push(Nc(n));return i.join("")}function Rc(r){for(var e,t=r.length,n=t%3,i=[],s=16383,o=0,a=t-n;o<a;o+=s)i.push(Uc(r,o,o+s>a?a:o+s));return n===1?(e=r[t-1],i.push(Z[e>>2]+Z[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(Z[e>>10]+Z[e>>4&63]+Z[e<<2&63]+"=")),i.join("")}});var ln=g(Qt=>{u();Qt.read=function(r,e,t,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,l=c>>1,h=-7,p=t?i-1:0,m=t?-1:1,w=r[e+p];for(p+=m,s=w&(1<<-h)-1,w>>=-h,h+=a;h>0;s=s*256+r[e+p],p+=m,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=n;h>0;o=o*256+r[e+p],p+=m,h-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(w?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-l}return(w?-1:1)*o*Math.pow(2,s-n)};Qt.write=function(r,e,t,n,i,s){var o,a,c,l=s*8-i-1,h=(1<<l)-1,p=h>>1,m=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=n?0:s-1,_=n?1:-1,A=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+p>=1?e+=m/c:e+=m*Math.pow(2,1-p),e*c>=2&&(o++,c/=2),o+p>=h?(a=0,o=h):o+p>=1?(a=(e*c-1)*Math.pow(2,i),o=o+p):(a=e*Math.pow(2,p-1)*Math.pow(2,i),o=0));i>=8;r[t+w]=a&255,w+=_,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;r[t+w]=o&255,w+=_,o/=256,l-=8);r[t+w-_]|=A*128}});var be=g(Ue=>{u();"use strict";var Kt=un(),De=ln(),hn=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Ue.Buffer=f;Ue.SlowBuffer=Gc;Ue.INSPECT_MAX_BYTES=50;var bt=2147483647;Ue.kMaxLength=bt;f.TYPED_ARRAY_SUPPORT=jc();!f.TYPED_ARRAY_SUPPORT&&typeof console!="undefined"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function jc(){try{let r=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(r,e),r.foo()===42}catch(r){return!1}}Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(!!f.isBuffer(this))return this.buffer}});Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(!!f.isBuffer(this))return this.byteOffset}});function ue(r){if(r>bt)throw new RangeError('The value "'+r+'" is invalid for option "size"');let e=new Uint8Array(r);return Object.setPrototypeOf(e,f.prototype),e}function f(r,e,t){if(typeof r=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Xt(r)}return fn(r,e,t)}f.poolSize=8192;function fn(r,e,t){if(typeof r=="string")return Wc(r,e);if(ArrayBuffer.isView(r))return Hc(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(Y(r,ArrayBuffer)||r&&Y(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer!="undefined"&&(Y(r,SharedArrayBuffer)||r&&Y(r.buffer,SharedArrayBuffer)))return Yt(r,e,t);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let n=r.valueOf&&r.valueOf();if(n!=null&&n!==r)return f.from(n,e,t);let i=$c(r);if(i)return i;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return f.from(r[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}f.from=function(r,e,t){return fn(r,e,t)};Object.setPrototypeOf(f.prototype,Uint8Array.prototype);Object.setPrototypeOf(f,Uint8Array);function pn(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function zc(r,e,t){return pn(r),r<=0?ue(r):e!==void 0?typeof t=="string"?ue(r).fill(e,t):ue(r).fill(e):ue(r)}f.alloc=function(r,e,t){return zc(r,e,t)};function Xt(r){return pn(r),ue(r<0?0:er(r)|0)}f.allocUnsafe=function(r){return Xt(r)};f.allocUnsafeSlow=function(r){return Xt(r)};function Wc(r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!f.isEncoding(e))throw new TypeError("Unknown encoding: "+e);let t=dn(r,e)|0,n=ue(t),i=n.write(r,e);return i!==t&&(n=n.slice(0,i)),n}function Zt(r){let e=r.length<0?0:er(r.length)|0,t=ue(e);for(let n=0;n<e;n+=1)t[n]=r[n]&255;return t}function Hc(r){if(Y(r,Uint8Array)){let e=new Uint8Array(r);return Yt(e.buffer,e.byteOffset,e.byteLength)}return Zt(r)}function Yt(r,e,t){if(e<0||r.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let n;return e===void 0&&t===void 0?n=new Uint8Array(r):t===void 0?n=new Uint8Array(r,e):n=new Uint8Array(r,e,t),Object.setPrototypeOf(n,f.prototype),n}function $c(r){if(f.isBuffer(r)){let e=er(r.length)|0,t=ue(e);return t.length===0||r.copy(t,0,0,e),t}if(r.length!==void 0)return typeof r.length!="number"||nr(r.length)?ue(0):Zt(r);if(r.type==="Buffer"&&Array.isArray(r.data))return Zt(r.data)}function er(r){if(r>=bt)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+bt.toString(16)+" bytes");return r|0}function Gc(r){return+r!=r&&(r=0),f.alloc(+r)}f.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==f.prototype};f.compare=function(e,t){if(Y(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),Y(t,Uint8Array)&&(t=f.from(t,t.offset,t.byteLength)),!f.isBuffer(e)||!f.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,i=t.length;for(let s=0,o=Math.min(n,i);s<o;++s)if(e[s]!==t[s]){n=e[s],i=t[s];break}return n<i?-1:i<n?1:0};f.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};f.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return f.alloc(0);let n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;let i=f.allocUnsafe(t),s=0;for(n=0;n<e.length;++n){let o=e[n];if(Y(o,Uint8Array))s+o.length>i.length?(f.isBuffer(o)||(o=f.from(o)),o.copy(i,s)):Uint8Array.prototype.set.call(i,o,s);else if(f.isBuffer(o))o.copy(i,s);else throw new TypeError('"list" argument must be an Array of Buffers');s+=o.length}return i};function dn(r,e){if(f.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||Y(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);let t=r.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&t===0)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return rr(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return An(r).length;default:if(i)return n?-1:rr(r).length;e=(""+e).toLowerCase(),i=!0}}f.byteLength=dn;function Vc(r,e,t){let n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return nu(this,e,t);case"utf8":case"utf-8":return wn(this,e,t);case"ascii":return tu(this,e,t);case"latin1":case"binary":return ru(this,e,t);case"base64":return Yc(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return iu(this,e,t);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),n=!0}}f.prototype._isBuffer=!0;function ke(r,e,t){let n=r[e];r[e]=r[t],r[t]=n}f.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)ke(this,t,t+1);return this};f.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)ke(this,t,t+3),ke(this,t+1,t+2);return this};f.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)ke(this,t,t+7),ke(this,t+1,t+6),ke(this,t+2,t+5),ke(this,t+3,t+4);return this};f.prototype.toString=function(){let e=this.length;return e===0?"":arguments.length===0?wn(this,0,e):Vc.apply(this,arguments)};f.prototype.toLocaleString=f.prototype.toString;f.prototype.equals=function(e){if(!f.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:f.compare(this,e)===0};f.prototype.inspect=function(){let e="",t=Ue.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"};hn&&(f.prototype[hn]=f.prototype.inspect);f.prototype.compare=function(e,t,n,i,s){if(Y(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),!f.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),i===void 0&&(i=0),s===void 0&&(s=this.length),t<0||n>e.length||i<0||s>this.length)throw new RangeError("out of range index");if(i>=s&&t>=n)return 0;if(i>=s)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,s>>>=0,this===e)return 0;let o=s-i,a=n-t,c=Math.min(o,a),l=this.slice(i,s),h=e.slice(t,n);for(let p=0;p<c;++p)if(l[p]!==h[p]){o=l[p],a=h[p];break}return o<a?-1:a<o?1:0};function yn(r,e,t,n,i){if(r.length===0)return-1;if(typeof t=="string"?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,nr(t)&&(t=i?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(i)return-1;t=r.length-1}else if(t<0)if(i)t=0;else return-1;if(typeof e=="string"&&(e=f.from(e,n)),f.isBuffer(e))return e.length===0?-1:gn(r,e,t,n,i);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):gn(r,[e],t,n,i);throw new TypeError("val must be string, number or Buffer")}function gn(r,e,t,n,i){let s=1,o=r.length,a=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(r.length<2||e.length<2)return-1;s=2,o/=2,a/=2,t/=2}function c(h,p){return s===1?h[p]:h.readUInt16BE(p*s)}let l;if(i){let h=-1;for(l=t;l<o;l++)if(c(r,l)===c(e,h===-1?0:l-h)){if(h===-1&&(h=l),l-h+1===a)return h*s}else h!==-1&&(l-=l-h),h=-1}else for(t+a>o&&(t=o-a),l=t;l>=0;l--){let h=!0;for(let p=0;p<a;p++)if(c(r,l+p)!==c(e,p)){h=!1;break}if(h)return l}return-1}f.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1};f.prototype.indexOf=function(e,t,n){return yn(this,e,t,n,!0)};f.prototype.lastIndexOf=function(e,t,n){return yn(this,e,t,n,!1)};function Jc(r,e,t,n){t=Number(t)||0;let i=r.length-t;n?(n=Number(n),n>i&&(n=i)):n=i;let s=e.length;n>s/2&&(n=s/2);let o;for(o=0;o<n;++o){let a=parseInt(e.substr(o*2,2),16);if(nr(a))return o;r[t+o]=a}return o}function Qc(r,e,t,n){return mt(rr(e,r.length-t),r,t,n)}function Kc(r,e,t,n){return mt(cu(e),r,t,n)}function Xc(r,e,t,n){return mt(An(e),r,t,n)}function Zc(r,e,t,n){return mt(uu(e,r.length-t),r,t,n)}f.prototype.write=function(e,t,n,i){if(t===void 0)i="utf8",n=this.length,t=0;else if(n===void 0&&typeof t=="string")i=t,n=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(n)?(n=n>>>0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let s=this.length-t;if((n===void 0||n>s)&&(n=s),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let o=!1;for(;;)switch(i){case"hex":return Jc(this,e,t,n);case"utf8":case"utf-8":return Qc(this,e,t,n);case"ascii":case"latin1":case"binary":return Kc(this,e,t,n);case"base64":return Xc(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Zc(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}};f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Yc(r,e,t){return e===0&&t===r.length?Kt.fromByteArray(r):Kt.fromByteArray(r.slice(e,t))}function wn(r,e,t){t=Math.min(r.length,t);let n=[],i=e;for(;i<t;){let s=r[i],o=null,a=s>239?4:s>223?3:s>191?2:1;if(i+a<=t){let c,l,h,p;switch(a){case 1:s<128&&(o=s);break;case 2:c=r[i+1],(c&192)==128&&(p=(s&31)<<6|c&63,p>127&&(o=p));break;case 3:c=r[i+1],l=r[i+2],(c&192)==128&&(l&192)==128&&(p=(s&15)<<12|(c&63)<<6|l&63,p>2047&&(p<55296||p>57343)&&(o=p));break;case 4:c=r[i+1],l=r[i+2],h=r[i+3],(c&192)==128&&(l&192)==128&&(h&192)==128&&(p=(s&15)<<18|(c&63)<<12|(l&63)<<6|h&63,p>65535&&p<1114112&&(o=p))}}o===null?(o=65533,a=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),i+=a}return eu(n)}var bn=4096;function eu(r){let e=r.length;if(e<=bn)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=bn));return t}function tu(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]&127);return n}function ru(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]);return n}function nu(r,e,t){let n=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>n)&&(t=n);let i="";for(let s=e;s<t;++s)i+=lu[r[s]];return i}function iu(r,e,t){let n=r.slice(e,t),i="";for(let s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+n[s+1]*256);return i}f.prototype.slice=function(e,t){let n=this.length;e=~~e,t=t===void 0?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);let i=this.subarray(e,t);return Object.setPrototypeOf(i,f.prototype),i};function N(r,e,t){if(r%1!=0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||N(e,t,this.length);let i=this[e],s=1,o=0;for(;++o<t&&(s*=256);)i+=this[e+o]*s;return i};f.prototype.readUintBE=f.prototype.readUIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||N(e,t,this.length);let i=this[e+--t],s=1;for(;t>0&&(s*=256);)i+=this[e+--t]*s;return i};f.prototype.readUint8=f.prototype.readUInt8=function(e,t){return e=e>>>0,t||N(e,1,this.length),this[e]};f.prototype.readUint16LE=f.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||N(e,2,this.length),this[e]|this[e+1]<<8};f.prototype.readUint16BE=f.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||N(e,2,this.length),this[e]<<8|this[e+1]};f.prototype.readUint32LE=f.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};f.prototype.readUint32BE=f.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||N(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};f.prototype.readBigUInt64LE=we(function(e){e=e>>>0,Ne(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&rt(e,this.length-8);let i=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,s=this[++e]+this[++e]*2**8+this[++e]*2**16+n*2**24;return BigInt(i)+(BigInt(s)<<BigInt(32))});f.prototype.readBigUInt64BE=we(function(e){e=e>>>0,Ne(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&rt(e,this.length-8);let i=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],s=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n;return(BigInt(i)<<BigInt(32))+BigInt(s)});f.prototype.readIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||N(e,t,this.length);let i=this[e],s=1,o=0;for(;++o<t&&(s*=256);)i+=this[e+o]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*t)),i};f.prototype.readIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||N(e,t,this.length);let i=t,s=1,o=this[e+--i];for(;i>0&&(s*=256);)o+=this[e+--i]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*t)),o};f.prototype.readInt8=function(e,t){return e=e>>>0,t||N(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};f.prototype.readInt16LE=function(e,t){e=e>>>0,t||N(e,2,this.length);let n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};f.prototype.readInt16BE=function(e,t){e=e>>>0,t||N(e,2,this.length);let n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};f.prototype.readInt32LE=function(e,t){return e=e>>>0,t||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};f.prototype.readInt32BE=function(e,t){return e=e>>>0,t||N(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};f.prototype.readBigInt64LE=we(function(e){e=e>>>0,Ne(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&rt(e,this.length-8);let i=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)});f.prototype.readBigInt64BE=we(function(e){e=e>>>0,Ne(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&rt(e,this.length-8);let i=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n)});f.prototype.readFloatLE=function(e,t){return e=e>>>0,t||N(e,4,this.length),De.read(this,e,!0,23,4)};f.prototype.readFloatBE=function(e,t){return e=e>>>0,t||N(e,4,this.length),De.read(this,e,!1,23,4)};f.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||N(e,8,this.length),De.read(this,e,!0,52,8)};f.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||N(e,8,this.length),De.read(this,e,!1,52,8)};function W(r,e,t,n,i,s){if(!f.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(t+n>r.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;W(this,e,t,n,a,0)}let s=1,o=0;for(this[t]=e&255;++o<n&&(s*=256);)this[t+o]=e/s&255;return t+n};f.prototype.writeUintBE=f.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;W(this,e,t,n,a,0)}let s=n-1,o=1;for(this[t+s]=e&255;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+n};f.prototype.writeUint8=f.prototype.writeUInt8=function(e,t,n){return e=+e,t=t>>>0,n||W(this,e,t,1,255,0),this[t]=e&255,t+1};f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||W(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2};f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||W(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2};f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||W(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4};f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||W(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function mn(r,e,t,n,i){kn(e,n,i,r,t,7);let s=Number(e&BigInt(4294967295));r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,t}function _n(r,e,t,n,i){kn(e,n,i,r,t,7);let s=Number(e&BigInt(4294967295));r[t+7]=s,s=s>>8,r[t+6]=s,s=s>>8,r[t+5]=s,s=s>>8,r[t+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t+3]=o,o=o>>8,r[t+2]=o,o=o>>8,r[t+1]=o,o=o>>8,r[t]=o,t+8}f.prototype.writeBigUInt64LE=we(function(e,t=0){return mn(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});f.prototype.writeBigUInt64BE=we(function(e,t=0){return _n(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});f.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let c=Math.pow(2,8*n-1);W(this,e,t,n,c-1,-c)}let s=0,o=1,a=0;for(this[t]=e&255;++s<n&&(o*=256);)e<0&&a===0&&this[t+s-1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};f.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let c=Math.pow(2,8*n-1);W(this,e,t,n,c-1,-c)}let s=n-1,o=1,a=0;for(this[t+s]=e&255;--s>=0&&(o*=256);)e<0&&a===0&&this[t+s+1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};f.prototype.writeInt8=function(e,t,n){return e=+e,t=t>>>0,n||W(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1};f.prototype.writeInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||W(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2};f.prototype.writeInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||W(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2};f.prototype.writeInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||W(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4};f.prototype.writeInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||W(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};f.prototype.writeBigInt64LE=we(function(e,t=0){return mn(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});f.prototype.writeBigInt64BE=we(function(e,t=0){return _n(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function xn(r,e,t,n,i,s){if(t+n>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function vn(r,e,t,n,i){return e=+e,t=t>>>0,i||xn(r,e,t,4,34028234663852886e22,-34028234663852886e22),De.write(r,e,t,n,23,4),t+4}f.prototype.writeFloatLE=function(e,t,n){return vn(this,e,t,!0,n)};f.prototype.writeFloatBE=function(e,t,n){return vn(this,e,t,!1,n)};function Bn(r,e,t,n,i){return e=+e,t=t>>>0,i||xn(r,e,t,8,17976931348623157e292,-17976931348623157e292),De.write(r,e,t,n,52,8),t+8}f.prototype.writeDoubleLE=function(e,t,n){return Bn(this,e,t,!0,n)};f.prototype.writeDoubleBE=function(e,t,n){return Bn(this,e,t,!1,n)};f.prototype.copy=function(e,t,n,i){if(!f.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),!i&&i!==0&&(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);let s=i-n;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),s};f.prototype.fill=function(e,t,n,i){if(typeof e=="string"){if(typeof t=="string"?(i=t,t=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!f.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(e.length===1){let o=e.charCodeAt(0);(i==="utf8"&&o<128||i==="latin1")&&(e=o)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t=t>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);let s;if(typeof e=="number")for(s=t;s<n;++s)this[s]=e;else{let o=f.isBuffer(e)?e:f.from(e,i),a=o.length;if(a===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<n-t;++s)this[s+t]=o[s%a]}return this};var qe={};function tr(r,e,t){qe[r]=class extends t{constructor(){super();Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${r}]`,this.stack,delete this.name}get code(){return r}set code(i){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:i,writable:!0})}toString(){return`${this.name} [${r}]: ${this.message}`}}}tr("ERR_BUFFER_OUT_OF_BOUNDS",function(r){return r?`${r} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);tr("ERR_INVALID_ARG_TYPE",function(r,e){return`The "${r}" argument must be of type number. Received type ${typeof e}`},TypeError);tr("ERR_OUT_OF_RANGE",function(r,e,t){let n=`The value of "${r}" is out of range.`,i=t;return Number.isInteger(t)&&Math.abs(t)>2**32?i=En(String(t)):typeof t=="bigint"&&(i=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(i=En(i)),i+="n"),n+=` It must be ${e}. Received ${i}`,n},RangeError);function En(r){let e="",t=r.length,n=r[0]==="-"?1:0;for(;t>=n+4;t-=3)e=`_${r.slice(t-3,t)}${e}`;return`${r.slice(0,t)}${e}`}function su(r,e,t){Ne(e,"offset"),(r[e]===void 0||r[e+t]===void 0)&&rt(e,r.length-(t+1))}function kn(r,e,t,n,i,s){if(r>t||r<e){let o=typeof e=="bigint"?"n":"",a;throw s>3?e===0||e===BigInt(0)?a=`>= 0${o} and < 2${o} ** ${(s+1)*8}${o}`:a=`>= -(2${o} ** ${(s+1)*8-1}${o}) and < 2 ** ${(s+1)*8-1}${o}`:a=`>= ${e}${o} and <= ${t}${o}`,new qe.ERR_OUT_OF_RANGE("value",a,r)}su(n,i,s)}function Ne(r,e){if(typeof r!="number")throw new qe.ERR_INVALID_ARG_TYPE(e,"number",r)}function rt(r,e,t){throw Math.floor(r)!==r?(Ne(r,t),new qe.ERR_OUT_OF_RANGE(t||"offset","an integer",r)):e<0?new qe.ERR_BUFFER_OUT_OF_BOUNDS:new qe.ERR_OUT_OF_RANGE(t||"offset",`>= ${t?1:0} and <= ${e}`,r)}var ou=/[^+/0-9A-Za-z-_]/g;function au(r){if(r=r.split("=")[0],r=r.trim().replace(ou,""),r.length<2)return"";for(;r.length%4!=0;)r=r+"=";return r}function rr(r,e){e=e||1/0;let t,n=r.length,i=null,s=[];for(let o=0;o<n;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function cu(r){let e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function uu(r,e){let t,n,i,s=[];for(let o=0;o<r.length&&!((e-=2)<0);++o)t=r.charCodeAt(o),n=t>>8,i=t%256,s.push(i),s.push(n);return s}function An(r){return Kt.toByteArray(au(r))}function mt(r,e,t,n){let i;for(i=0;i<n&&!(i+t>=e.length||i>=r.length);++i)e[i+t]=r[i];return i}function Y(r,e){return r instanceof e||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===e.name}function nr(r){return r!==r}var lu=function(){let r="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){let n=t*16;for(let i=0;i<16;++i)e[n+i]=r[t]+r[i]}return e}();function we(r){return typeof BigInt=="undefined"?hu:r}function hu(){throw new Error("BigInt not supported")}});var On=g((bp,Fn)=>{u();var I=Fn.exports={},ee,te;function ir(){throw new Error("setTimeout has not been defined")}function sr(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?ee=setTimeout:ee=ir}catch(r){ee=ir}try{typeof clearTimeout=="function"?te=clearTimeout:te=sr}catch(r){te=sr}})();function Sn(r){if(ee===setTimeout)return setTimeout(r,0);if((ee===ir||!ee)&&setTimeout)return ee=setTimeout,setTimeout(r,0);try{return ee(r,0)}catch(e){try{return ee.call(null,r,0)}catch(t){return ee.call(this,r,0)}}}function fu(r){if(te===clearTimeout)return clearTimeout(r);if((te===sr||!te)&&clearTimeout)return te=clearTimeout,clearTimeout(r);try{return te(r)}catch(e){try{return te.call(null,r)}catch(t){return te.call(this,r)}}}var le=[],Re=!1,Ae,_t=-1;function pu(){!Re||!Ae||(Re=!1,Ae.length?le=Ae.concat(le):_t=-1,le.length&&Cn())}function Cn(){if(!Re){var r=Sn(pu);Re=!0;for(var e=le.length;e;){for(Ae=le,le=[];++_t<e;)Ae&&Ae[_t].run();_t=-1,e=le.length}Ae=null,Re=!1,fu(r)}}I.nextTick=function(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];le.push(new Tn(r,e)),le.length===1&&!Re&&Sn(Cn)};function Tn(r,e){this.fun=r,this.array=e}Tn.prototype.run=function(){this.fun.apply(null,this.array)};I.title="browser";I.browser=!0;I.env={};I.argv=[];I.version="";I.versions={};function he(){}I.on=he;I.addListener=he;I.once=he;I.off=he;I.removeListener=he;I.removeAllListeners=he;I.emit=he;I.prependListener=he;I.prependOnceListener=he;I.listeners=function(r){return[]};I.binding=function(r){throw new Error("process.binding is not supported")};I.cwd=function(){return"/"};I.chdir=function(r){throw new Error("process.chdir is not supported")};I.umask=function(){return 0}});var y,d,u=z(()=>{y=an(be()),d=an(On())});function Ln(r,e,t){e=e||[],t=t||0;for(var n=t;r>=wu;)e[t++]=r&255|Mn,r/=128;for(;r&gu;)e[t++]=r&255|Mn,r>>>=7;return e[t]=r|0,Ln.bytes=t-n+1,e}function or(r,e){var t=0,e=e||0,n=0,i=e,s,o=r.length;do{if(i>=o)throw or.bytes=0,new RangeError("Could not decode varint");s=r[i++],t+=n<28?(s&In)<<n:(s&In)*Math.pow(2,n),n+=7}while(s>=mu);return or.bytes=i-e,t}var du,Mn,yu,gu,wu,bu,mu,In,_u,xu,vu,Bu,Eu,ku,Au,Su,Cu,Tu,Fu,Ou,nt,Pn=z(()=>{u();du=Ln,Mn=128,yu=127,gu=~yu,wu=Math.pow(2,31);bu=or,mu=128,In=127;_u=Math.pow(2,7),xu=Math.pow(2,14),vu=Math.pow(2,21),Bu=Math.pow(2,28),Eu=Math.pow(2,35),ku=Math.pow(2,42),Au=Math.pow(2,49),Su=Math.pow(2,56),Cu=Math.pow(2,63),Tu=function(r){return r<_u?1:r<xu?2:r<vu?3:r<Bu?4:r<Eu?5:r<ku?6:r<Au?7:r<Su?8:r<Cu?9:10},Fu={encode:du,decode:bu,encodingLength:Tu},Ou=Fu,nt=Ou});var ar={};X(ar,{decode:()=>je,encodeTo:()=>Se,encodingLength:()=>Ce});var je,Se,Ce,xt=z(()=>{u();Pn();je=r=>[nt.decode(r),nt.decode.bytes],Se=(r,e,t=0)=>(nt.encode(r,e,t),e),Ce=r=>nt.encodingLength(r)});var ur={};X(ur,{coerce:()=>fe,empty:()=>Dn,equals:()=>cr,fromHex:()=>Lu,fromString:()=>Pu,isBinary:()=>Iu,toHex:()=>Mu,toString:()=>Du});var Dn,Mu,Lu,cr,fe,Iu,Pu,Du,ze=z(()=>{u();Dn=new Uint8Array(0),Mu=r=>r.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),Lu=r=>{let e=r.match(/../g);return e?new Uint8Array(e.map(t=>parseInt(t,16))):Dn},cr=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},fe=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Iu=r=>r instanceof ArrayBuffer||ArrayBuffer.isView(r),Pu=r=>new TextEncoder().encode(r),Du=r=>new TextDecoder().decode(r)});var vt={};X(vt,{Digest:()=>We,create:()=>it,decode:()=>lr,equals:()=>hr});var it,lr,hr,We,st=z(()=>{u();ze();xt();it=(r,e)=>{let t=e.byteLength,n=Ce(r),i=n+Ce(t),s=new Uint8Array(i+t);return Se(r,s,0),Se(t,s,n),s.set(e,i),new We(r,t,e,s)},lr=r=>{let e=fe(r),[t,n]=je(e),[i,s]=je(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new We(t,i,o,e)},hr=(r,e)=>r===e?!0:r.code===e.code&&r.size===e.size&&cr(r.bytes,e.bytes),We=class{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}}});function qu(r){if(r.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),t=0;t<e.length;t++)e[t]=255;for(var n=0;n<r.length;n++){var i=r.charAt(n),s=i.charCodeAt(0);if(e[s]!==255)throw new TypeError(i+" is ambiguous");e[s]=n}var o=r.length,a=r.charAt(0),c=Math.log(o)/Math.log(256),l=Math.log(256)/Math.log(o);function h(w){if(w instanceof Uint8Array||(ArrayBuffer.isView(w)?w=new Uint8Array(w.buffer,w.byteOffset,w.byteLength):Array.isArray(w)&&(w=Uint8Array.from(w))),!(w instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(w.length===0)return"";for(var _=0,A=0,x=0,k=w.length;x!==k&&w[x]===0;)x++,_++;for(var F=(k-x)*l+1>>>0,C=new Uint8Array(F);x!==k;){for(var O=w[x],q=0,T=F-1;(O!==0||q<A)&&T!==-1;T--,q++)O+=256*C[T]>>>0,C[T]=O%o>>>0,O=O/o>>>0;if(O!==0)throw new Error("Non-zero carry");A=q,x++}for(var L=F-A;L!==F&&C[L]===0;)L++;for(var G=a.repeat(_);L<F;++L)G+=r.charAt(C[L]);return G}function p(w){if(typeof w!="string")throw new TypeError("Expected String");if(w.length===0)return new Uint8Array;var _=0;if(w[_]!==" "){for(var A=0,x=0;w[_]===a;)A++,_++;for(var k=(w.length-_)*c+1>>>0,F=new Uint8Array(k);w[_];){var C=e[w.charCodeAt(_)];if(C===255)return;for(var O=0,q=k-1;(C!==0||O<x)&&q!==-1;q--,O++)C+=o*F[q]>>>0,F[q]=C%256>>>0,C=C/256>>>0;if(C!==0)throw new Error("Non-zero carry");x=O,_++}if(w[_]!==" "){for(var T=k-x;T!==k&&F[T]===0;)T++;for(var L=new Uint8Array(A+(k-T)),G=A;T!==k;)L[G++]=F[T++];return L}}}function m(w){var _=p(w);if(_)return _;throw new Error("Non-base"+o+" character")}return{encode:h,decodeUnsafe:p,decode:m}}var Nu,Uu,qn,Nn=z(()=>{u();Nu=qu,Uu=Nu,qn=Uu});var Un,Rn,Bt,jn,re,Et,fr=z(()=>{u();Un=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Rn=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseDecode=n}decode(e){if(typeof e=="string")switch(e[0]){case this.prefix:return this.baseDecode(e.slice(1));default:throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`)}else throw Error("Can only multibase decode strings")}or(e){let t={[this.prefix]:this,...e.decoders||{[e.prefix]:e}};return new Bt(t)}},Bt=class{constructor(e){this.decoders=e}or(e){let t=e.decoders||{[e.prefix]:e};return new Bt({...this.decoders,...t})}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},jn=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Un(e,t,n),this.decoder=new Rn(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},re=({name:r,prefix:e,encode:t,decode:n,alphabet:i})=>Et({name:r,prefix:e,encode:s=>t(s,i),decode:s=>{for(let o of s)if(i.indexOf(o)<0)throw new Error(`invalid ${r} character`);return n(s,i)}}),Et=({name:r,prefix:e,encode:t,decode:n})=>new jn(r,e,t,n)});var Te={};X(Te,{base58btc:()=>ne,base58flickr:()=>Ru});var zn,ne,Ru,me=z(()=>{u();Nn();ze();fr();zn=r=>{let{encode:e,decode:t}=qn(r);return{encode:e,decode:n=>fe(t(n))}},ne=Et({name:"base58btc",prefix:"z",...zn("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")}),Ru=Et({name:"base58flickr",prefix:"Z",...zn("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ")})});var Wn={};X(Wn,{base32:()=>He,base32hex:()=>Hu,base32hexpad:()=>Gu,base32hexpadupper:()=>Vu,base32hexupper:()=>$u,base32pad:()=>zu,base32padupper:()=>Wu,base32upper:()=>ju,base32z:()=>Ju});function pe(r,e){r=r.replace(/=/g,"");let t=r.length,n=0,i=0,s=0,o=new Uint8Array(t*5/8|0);for(let a=0;a<t;a++)i=i<<5|e.indexOf(r[a]),n+=5,n>=8&&(o[s++]=i>>>n-8&255,n-=8);return o}function de(r,e){let t=r.byteLength,n=new Uint8Array(r),i=e.indexOf("=")===e.length-1;i&&(e=e.substring(0,e.length-1));let s=0,o=0,a="";for(let c=0;c<t;c++)for(o=o<<8|n[c],s+=8;s>=5;)a+=e[o>>>s-5&31],s-=5;if(s>0&&(a+=e[o<<5-s&31]),i)for(;a.length%8!=0;)a+="=";return a}var He,ju,zu,Wu,Hu,$u,Gu,Vu,Ju,pr=z(()=>{u();fr();He=re({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",encode:de,decode:pe}),ju=re({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",encode:de,decode:pe}),zu=re({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",encode:de,decode:pe}),Wu=re({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",encode:de,decode:pe}),Hu=re({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",encode:de,decode:pe}),$u=re({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",encode:de,decode:pe}),Gu=re({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",encode:de,decode:pe}),Vu=re({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",encode:de,decode:pe}),Ju=re({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",encode:de,decode:pe})});var Gn={};X(Gn,{CID:()=>D});var D,Qu,Ku,Xu,ot,Zu,Hn,$n,kt,At,Yu,el,tl,dr=z(()=>{u();xt();st();me();pr();ze();D=class{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this.byteOffset=i.byteOffset,this.byteLength=i.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:At,byteLength:At,code:kt,version:kt,multihash:kt,bytes:kt,_baseCache:At,asCID:At})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:t}=this;if(e!==ot)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Zu)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return D.createV0(t)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=it(e,t);return D.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&hr(this.multihash,e.multihash)}toString(e){let{bytes:t,version:n,_baseCache:i}=this;switch(n){case 0:return Ku(t,i,e||ne.encoder);default:return Xu(t,i,e||He.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return el(/^0\.0/,tl),!!(e&&(e[$n]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof D)return e;if(e!=null&&e.asCID===e){let{version:t,code:n,multihash:i,bytes:s}=e;return new D(t,n,i,s||Hn(t,n,i.bytes))}else if(e!=null&&e[$n]===!0){let{version:t,multihash:n,code:i}=e,s=lr(n);return D.create(t,i,s)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(t!==ot)throw new Error(`Version 0 CID must use dag-pb (code: ${ot}) block encoding`);return new D(e,t,n,n.bytes)}case 1:{let i=Hn(e,t,n.bytes);return new D(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return D.create(0,ot,e)}static createV1(e,t){return D.create(1,e,t)}static decode(e){let[t,n]=D.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=D.inspectBytes(e),n=t.size-t.multihashSize,i=fe(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");let s=i.subarray(t.multihashSize-t.digestSize),o=new We(t.multihashCode,t.digestSize,s,i);return[t.version===0?D.createV0(o):D.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[p,m]=je(e.subarray(t));return t+=m,p},i=n(),s=ot;if(i===18?(i=0,t=0):i===1&&(s=n()),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){let[n,i]=Qu(e,t),s=D.decode(i);return s._baseCache.set(n,e),s}},Qu=(r,e)=>{switch(r[0]){case"Q":{let t=e||ne;return[ne.prefix,t.decode(`${ne.prefix}${r}`)]}case ne.prefix:{let t=e||ne;return[ne.prefix,t.decode(r)]}case He.prefix:{let t=e||He;return[He.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Ku=(r,e,t)=>{let{prefix:n}=t;if(n!==ne.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let i=e.get(n);if(i==null){let s=t.encode(r).slice(1);return e.set(n,s),s}else return i},Xu=(r,e,t)=>{let{prefix:n}=t,i=e.get(n);if(i==null){let s=t.encode(r);return e.set(n,s),s}else return i},ot=112,Zu=18,Hn=(r,e,t)=>{let n=Ce(r),i=n+Ce(e),s=new Uint8Array(i+t.byteLength);return Se(r,s,0),Se(e,s,n),s.set(t,i),s},$n=Symbol.for("@ipld/js-cid/CID"),kt={writable:!1,configurable:!1,enumerable:!0},At={writable:!1,enumerable:!1,configurable:!1},Yu="0.0.0-dev",el=(r,e)=>{if(r.test(Yu))console.warn(e);else throw new Error(e)},tl=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`});var gr={};X(gr,{Hasher:()=>yr,from:()=>St});var St,yr,wr=z(()=>{u();st();St=({name:r,code:e,encode:t})=>new yr(r,e,t),yr=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}async digest(e){if(e instanceof Uint8Array){let t=await this.encode(e);return it(this.code,t)}else throw Error("Unknown type, must be binary type")}}});var Ct={};X(Ct,{CID:()=>D,bytes:()=>ur,digest:()=>vt,hasher:()=>gr,varint:()=>ar});var Tt=z(()=>{u();dr();xt();ze();wr();st()});var Jn={};X(Jn,{__browser:()=>il,sha256:()=>rl,sha512:()=>nl});var Vn,rl,nl,il,Qn=z(()=>{u();wr();Vn=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),rl=St({name:"sha2-256",code:18,encode:Vn("SHA-256")}),nl=St({name:"sha2-512",code:19,encode:Vn("SHA-512")}),il=!0});var Yn=g((Np,Zn)=>{u();Zn.exports=Xn;var Kn=128,sl=127,ol=~sl,al=Math.pow(2,31);function Xn(r,e,t){e=e||[],t=t||0;for(var n=t;r>=al;)e[t++]=r&255|Kn,r/=128;for(;r&ol;)e[t++]=r&255|Kn,r>>>=7;return e[t]=r|0,Xn.bytes=t-n+1,e}});var ri=g((Up,ti)=>{u();ti.exports=br;var cl=128,ei=127;function br(r,e){var t=0,e=e||0,n=0,i=e,s,o=r.length;do{if(i>=o)throw br.bytes=0,new RangeError("Could not decode varint");s=r[i++],t+=n<28?(s&ei)<<n:(s&ei)*Math.pow(2,n),n+=7}while(s>=cl);return br.bytes=i-e,t}});var ii=g((Rp,ni)=>{u();var ul=Math.pow(2,7),ll=Math.pow(2,14),hl=Math.pow(2,21),fl=Math.pow(2,28),pl=Math.pow(2,35),dl=Math.pow(2,42),yl=Math.pow(2,49),gl=Math.pow(2,56),wl=Math.pow(2,63);ni.exports=function(r){return r<ul?1:r<ll?2:r<hl?3:r<fl?4:r<pl?5:r<dl?6:r<yl?7:r<gl?8:r<wl?9:10}});var oi=g((jp,si)=>{u();si.exports={encode:Yn(),decode:ri(),encodingLength:ii()}});var ui=g((zp,ci)=>{u();"use strict";var ai=oi();ci.exports=r=>{if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");let e=[];for(;r.length>0;){let t=ai.decode(r);e.push(t),r=r.slice(ai.decode.bytes)}return e}});var hi=g((Wp,li)=>{u();var $e=1e3,Ge=$e*60,Ve=Ge*60,Fe=Ve*24,bl=Fe*7,ml=Fe*365.25;li.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return _l(r);if(t==="number"&&isFinite(r))return e.long?vl(r):xl(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function _l(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!!e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*ml;case"weeks":case"week":case"w":return t*bl;case"days":case"day":case"d":return t*Fe;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Ve;case"minutes":case"minute":case"mins":case"min":case"m":return t*Ge;case"seconds":case"second":case"secs":case"sec":case"s":return t*$e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function xl(r){var e=Math.abs(r);return e>=Fe?Math.round(r/Fe)+"d":e>=Ve?Math.round(r/Ve)+"h":e>=Ge?Math.round(r/Ge)+"m":e>=$e?Math.round(r/$e)+"s":r+"ms"}function vl(r){var e=Math.abs(r);return e>=Fe?Ft(r,e,Fe,"day"):e>=Ve?Ft(r,e,Ve,"hour"):e>=Ge?Ft(r,e,Ge,"minute"):e>=$e?Ft(r,e,$e,"second"):r+" ms"}function Ft(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var pi=g((Hp,fi)=>{u();function Bl(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=i,t.enabled=o,t.humanize=hi(),t.destroy=l,Object.keys(r).forEach(h=>{t[h]=r[h]}),t.names=[],t.skips=[],t.formatters={};function e(h){let p=0;for(let m=0;m<h.length;m++)p=(p<<5)-p+h.charCodeAt(m),p|=0;return t.colors[Math.abs(p)%t.colors.length]}t.selectColor=e;function t(h){let p,m=null,w,_;function A(...x){if(!A.enabled)return;let k=A,F=Number(new Date),C=F-(p||F);k.diff=C,k.prev=p,k.curr=F,p=F,x[0]=t.coerce(x[0]),typeof x[0]!="string"&&x.unshift("%O");let O=0;x[0]=x[0].replace(/%([a-zA-Z%])/g,(T,L)=>{if(T==="%%")return"%";O++;let G=t.formatters[L];if(typeof G=="function"){let Ac=x[O];T=G.call(k,Ac),x.splice(O,1),O--}return T}),t.formatArgs.call(k,x),(k.log||t.log).apply(k,x)}return A.namespace=h,A.useColors=t.useColors(),A.color=t.selectColor(h),A.extend=n,A.destroy=t.destroy,Object.defineProperty(A,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(w!==t.namespaces&&(w=t.namespaces,_=t.enabled(h)),_),set:x=>{m=x}}),typeof t.init=="function"&&t.init(A),A}function n(h,p){let m=t(this.namespace+(typeof p=="undefined"?":":p)+h);return m.log=this.log,m}function i(h){t.save(h),t.namespaces=h,t.names=[],t.skips=[];let p,m=(typeof h=="string"?h:"").split(/[\s,]+/),w=m.length;for(p=0;p<w;p++)!m[p]||(h=m[p].replace(/\*/g,".*?"),h[0]==="-"?t.skips.push(new RegExp("^"+h.substr(1)+"$")):t.names.push(new RegExp("^"+h+"$")))}function s(){let h=[...t.names.map(a),...t.skips.map(a).map(p=>"-"+p)].join(",");return t.enable(""),h}function o(h){if(h[h.length-1]==="*")return!0;let p,m;for(p=0,m=t.skips.length;p<m;p++)if(t.skips[p].test(h))return!1;for(p=0,m=t.names.length;p<m;p++)if(t.names[p].test(h))return!0;return!1}function a(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}function c(h){return h instanceof Error?h.stack||h.message:h}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}fi.exports=Bl});var di=g(($,Ot)=>{u();$.formatArgs=kl;$.save=Al;$.load=Sl;$.useColors=El;$.storage=Cl();$.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();$.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function El(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function kl(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+Ot.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}$.log=console.debug||console.log||(()=>{});function Al(r){try{r?$.storage.setItem("debug",r):$.storage.removeItem("debug")}catch(e){}}function Sl(){let r;try{r=$.storage.getItem("debug")}catch(e){}return!r&&typeof d.default!="undefined"&&"env"in d.default&&(r=d.default.env.DEBUG),r}function Cl(){try{return localStorage}catch(r){}}Ot.exports=pi()($);var{formatters:Tl}=Ot.exports;Tl.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var gi=g(($p,yi)=>{u();"use strict";function Fl(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}yi.exports=Fl});var mi=g((Gp,bi)=>{u();"use strict";var{base58btc:Ol}=(me(),Te),wi=class{constructor(e,t,n){this._refCounter=1,this.cid=e,this.priority=t||1,this.wantType=n}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){return`WantlistEntry <key: ${this.cid.toString(Ol)}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority&&this.wantType===e.wantType}};bi.exports=wi});var at=g((Vp,xi)=>{u();"use strict";var _i=mi(),{base58btc:Mt}=(me(),Te),Ml=(r,e)=>Array.prototype.slice.call(e,0).sort((t,n)=>{let i=r(t),s=r(n);return i<s?-1:i>s?1:0}),mr=class{constructor(e){this.set=new Map,this._stats=e}get length(){return this.set.size}add(e,t,n){let i=Je(),s=e.toString(Mt),o=this.set.get(s);o?(o.inc(),o.priority=t,o.wantType===i.WantType.Have&&n===i.WantType.Block&&(o.wantType=n)):(this.set.set(s,new _i(e,t,n)),this._stats&&this._stats.push(null,"wantListSize",1))}remove(e){let t=e.toString(Mt),n=this.set.get(t);!n||(n.dec(),!n.hasRefs()&&(this.set.delete(t),this._stats&&this._stats.push(null,"wantListSize",-1)))}removeForce(e){this.set.has(e)&&this.set.delete(e)}forEach(e){return this.set.forEach(e)}entries(){return this.set.entries()}sortedEntries(){return new Map(Ml(e=>e[1].key,Array.from(this.set.entries())))}contains(e){let t=e.toString(Mt);return this.set.has(t)}get(e){let t=e.toString(Mt);return this.set.get(t)}};mr.Entry=_i;xi.exports=mr});var _r=g((Qp,vi)=>{u();"use strict";var Ll=at().Entry,{base58btc:Il}=(me(),Te);vi.exports=class{constructor(e,t,n,i,s){this.entry=new Ll(e,t,n),this.cancel=Boolean(i),this.sendDontHave=Boolean(s)}get cid(){return this.entry.cid}set cid(e){this.entry.cid=e}get priority(){return this.entry.priority}set priority(e){this.entry.priority=e}get wantType(){return this.entry.wantType}set wantType(e){this.entry.wantType=e}get[Symbol.toStringTag](){return`BitswapMessageEntry ${this.cid.toString(Il)} <cancel: ${this.cancel}, priority: ${this.priority}>`}equals(e){return this.cancel===e.cancel&&this.sendDontHave===e.sendDontHave&&this.wantType===e.wantType&&this.entry.equals(e.entry)}}});var _e=g((Kp,ki)=>{u();"use strict";var Bi=di(),Pl=gi(),Ei=_r(),Dl=(r,e)=>{let t=["bitswap"];return e&&t.push(e),r&&t.push(`${r.toB58String().slice(0,8)}`),Object.assign(Bi(t.join(":")),{error:Bi(t.concat(["error"]).join(":"))})},xr=(r,e,t)=>{let n=0,i=t.length;for(;n<i;){if(r(e,t[n]))return!0;n+=1}return!1},ql=(r,e)=>{let t=0,n=e.length,i=[],s;for(;t<n;)s=e[t],xr(r,s,i)||(i[i.length]=s),t+=1;return i},Nl=(r,e)=>e.reduce((t,n)=>{let i=r(n);return t[i]?t[i].push(n):t[i]=[n],t},{}),Ul=(r,e,t)=>e.filter(n=>!xr(r,n,t)),Rl=(r,e)=>Array.prototype.slice.call(e,0).sort((t,n)=>{let i=r(t),s=r(n);return i<s?-1:i>s?1:0}),jl=(r,e)=>{if(r.size!==e.size)return!1;for(let[t,n]of r){let i=e.get(t);if(i===void 0||n instanceof Uint8Array&&i instanceof Uint8Array&&!Pl(n,i)||n instanceof Ei&&i instanceof Ei&&!n.equals(i))return!1}return!0};ki.exports={logger:Dl,includesWith:xr,uniqWith:ql,groupBy:Nl,pullAllWith:Ul,sortBy:Rl,isMapEqual:jl}});var Si=g((Xp,Ai)=>{u();"use strict";Ai.exports=zl;function zl(r,e){for(var t=new Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)t[n++]=arguments[i++];return new Promise(function(a,c){t[n]=function(h){if(s)if(s=!1,h)c(h);else{for(var p=new Array(arguments.length-1),m=0;m<p.length;)p[m++]=arguments[m];a.apply(null,p)}};try{r.apply(e||null,t)}catch(l){s&&(s=!1,c(l))}})}});var Oi=g(Fi=>{u();"use strict";var Lt=Fi;Lt.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&e.charAt(t)==="=";)++n;return Math.ceil(e.length*3)/4-n};var Qe=new Array(64),Ci=new Array(123);for(var ie=0;ie<64;)Ci[Qe[ie]=ie<26?ie+65:ie<52?ie+71:ie<62?ie-4:ie-59|43]=ie++;Lt.encode=function(e,t,n){for(var i=null,s=[],o=0,a=0,c;t<n;){var l=e[t++];switch(a){case 0:s[o++]=Qe[l>>2],c=(l&3)<<4,a=1;break;case 1:s[o++]=Qe[c|l>>4],c=(l&15)<<2,a=2;break;case 2:s[o++]=Qe[c|l>>6],s[o++]=Qe[l&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=Qe[c],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var Ti="invalid encoding";Lt.decode=function(e,t,n){for(var i=n,s=0,o,a=0;a<e.length;){var c=e.charCodeAt(a++);if(c===61&&s>1)break;if((c=Ci[c])===void 0)throw Error(Ti);switch(s){case 0:o=c,s=1;break;case 1:t[n++]=o<<2|(c&48)>>4,o=c,s=2;break;case 2:t[n++]=(o&15)<<4|(c&60)>>2,o=c,s=3;break;case 3:t[n++]=(o&3)<<6|c,s=0;break}}if(s===1)throw Error(Ti);return n-i};Lt.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var Li=g((Yp,Mi)=>{u();"use strict";Mi.exports=It;function It(){this._listeners={}}It.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this};It.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var n=this._listeners[e],i=0;i<n.length;)n[i].fn===t?n.splice(i,1):++i;return this};It.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,n)}return this}});var Ri=g((ed,Ui)=>{u();"use strict";Ui.exports=Ii(Ii);function Ii(r){return typeof Float32Array!="undefined"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),n=t[3]===128;function i(c,l,h){e[0]=c,l[h]=t[0],l[h+1]=t[1],l[h+2]=t[2],l[h+3]=t[3]}function s(c,l,h){e[0]=c,l[h]=t[3],l[h+1]=t[2],l[h+2]=t[1],l[h+3]=t[0]}r.writeFloatLE=n?i:s,r.writeFloatBE=n?s:i;function o(c,l){return t[0]=c[l],t[1]=c[l+1],t[2]=c[l+2],t[3]=c[l+3],e[0]}function a(c,l){return t[3]=c[l],t[2]=c[l+1],t[1]=c[l+2],t[0]=c[l+3],e[0]}r.readFloatLE=n?o:a,r.readFloatBE=n?a:o}():function(){function e(n,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)n(1/i>0?0:2147483648,s,o);else if(isNaN(i))n(2143289344,s,o);else if(i>34028234663852886e22)n((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)n((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var c=Math.floor(Math.log(i)/Math.LN2),l=Math.round(i*Math.pow(2,-c)*8388608)&8388607;n((a<<31|c+127<<23|l)>>>0,s,o)}}r.writeFloatLE=e.bind(null,Pi),r.writeFloatBE=e.bind(null,Di);function t(n,i,s){var o=n(i,s),a=(o>>31)*2+1,c=o>>>23&255,l=o&8388607;return c===255?l?NaN:a*(1/0):c===0?a*1401298464324817e-60*l:a*Math.pow(2,c-150)*(l+8388608)}r.readFloatLE=t.bind(null,qi),r.readFloatBE=t.bind(null,Ni)}(),typeof Float64Array!="undefined"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),n=t[7]===128;function i(c,l,h){e[0]=c,l[h]=t[0],l[h+1]=t[1],l[h+2]=t[2],l[h+3]=t[3],l[h+4]=t[4],l[h+5]=t[5],l[h+6]=t[6],l[h+7]=t[7]}function s(c,l,h){e[0]=c,l[h]=t[7],l[h+1]=t[6],l[h+2]=t[5],l[h+3]=t[4],l[h+4]=t[3],l[h+5]=t[2],l[h+6]=t[1],l[h+7]=t[0]}r.writeDoubleLE=n?i:s,r.writeDoubleBE=n?s:i;function o(c,l){return t[0]=c[l],t[1]=c[l+1],t[2]=c[l+2],t[3]=c[l+3],t[4]=c[l+4],t[5]=c[l+5],t[6]=c[l+6],t[7]=c[l+7],e[0]}function a(c,l){return t[7]=c[l],t[6]=c[l+1],t[5]=c[l+2],t[4]=c[l+3],t[3]=c[l+4],t[2]=c[l+5],t[1]=c[l+6],t[0]=c[l+7],e[0]}r.readDoubleLE=n?o:a,r.readDoubleBE=n?a:o}():function(){function e(n,i,s,o,a,c){var l=o<0?1:0;if(l&&(o=-o),o===0)n(0,a,c+i),n(1/o>0?0:2147483648,a,c+s);else if(isNaN(o))n(0,a,c+i),n(2146959360,a,c+s);else if(o>17976931348623157e292)n(0,a,c+i),n((l<<31|2146435072)>>>0,a,c+s);else{var h;if(o<22250738585072014e-324)h=o/5e-324,n(h>>>0,a,c+i),n((l<<31|h/4294967296)>>>0,a,c+s);else{var p=Math.floor(Math.log(o)/Math.LN2);p===1024&&(p=1023),h=o*Math.pow(2,-p),n(h*4503599627370496>>>0,a,c+i),n((l<<31|p+1023<<20|h*1048576&1048575)>>>0,a,c+s)}}}r.writeDoubleLE=e.bind(null,Pi,0,4),r.writeDoubleBE=e.bind(null,Di,4,0);function t(n,i,s,o,a){var c=n(o,a+i),l=n(o,a+s),h=(l>>31)*2+1,p=l>>>20&2047,m=4294967296*(l&1048575)+c;return p===2047?m?NaN:h*(1/0):p===0?h*5e-324*m:h*Math.pow(2,p-1075)*(m+4503599627370496)}r.readDoubleLE=t.bind(null,qi,0,4),r.readDoubleBE=t.bind(null,Ni,4,0)}(),r}function Pi(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function Di(r,e,t){e[t]=r>>>24,e[t+1]=r>>>16&255,e[t+2]=r>>>8&255,e[t+3]=r&255}function qi(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0}function Ni(r,e){return(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}});var ji=g((exports,module)=>{u();"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(r){}return null}});var Wi=g(zi=>{u();"use strict";var vr=zi;vr.length=function(e){for(var t=0,n=0,i=0;i<e.length;++i)n=e.charCodeAt(i),n<128?t+=1:n<2048?t+=2:(n&64512)==55296&&(e.charCodeAt(i+1)&64512)==56320?(++i,t+=4):t+=3;return t};vr.read=function(e,t,n){var i=n-t;if(i<1)return"";for(var s=null,o=[],a=0,c;t<n;)c=e[t++],c<128?o[a++]=c:c>191&&c<224?o[a++]=(c&31)<<6|e[t++]&63:c>239&&c<365?(c=((c&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(c>>10),o[a++]=56320+(c&1023)):o[a++]=(c&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};vr.write=function(e,t,n){for(var i=n,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=s&63|128):(s&64512)==55296&&((o=e.charCodeAt(a+1))&64512)==56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=s&63|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=s&63|128);return n-i}});var $i=g((rd,Hi)=>{u();"use strict";Hi.exports=Wl;function Wl(r,e,t){var n=t||8192,i=n>>>1,s=null,o=n;return function(c){if(c<1||c>i)return r(c);o+c>n&&(s=r(n),o=0);var l=e.call(s,o,o+=c);return o&7&&(o=(o|7)+1),l}}});var Vi=g((nd,Gi)=>{u();"use strict";Gi.exports=U;var ct=ve();function U(r,e){this.lo=r>>>0,this.hi=e>>>0}var Oe=U.zero=new U(0,0);Oe.toNumber=function(){return 0};Oe.zzEncode=Oe.zzDecode=function(){return this};Oe.length=function(){return 1};var Hl=U.zeroHash="\0\0\0\0\0\0\0\0";U.fromNumber=function(e){if(e===0)return Oe;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new U(n,i)};U.from=function(e){if(typeof e=="number")return U.fromNumber(e);if(ct.isString(e))if(ct.Long)e=ct.Long.fromString(e);else return U.fromNumber(parseInt(e,10));return e.low||e.high?new U(e.low>>>0,e.high>>>0):Oe};U.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};U.prototype.toLong=function(e){return ct.Long?new ct.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var xe=String.prototype.charCodeAt;U.fromHash=function(e){return e===Hl?Oe:new U((xe.call(e,0)|xe.call(e,1)<<8|xe.call(e,2)<<16|xe.call(e,3)<<24)>>>0,(xe.call(e,4)|xe.call(e,5)<<8|xe.call(e,6)<<16|xe.call(e,7)<<24)>>>0)};U.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};U.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};U.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};U.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var ve=g(Br=>{u();"use strict";var b=Br;b.asPromise=Si();b.base64=Oi();b.EventEmitter=Li();b.float=Ri();b.inquire=ji();b.utf8=Wi();b.pool=$i();b.LongBits=Vi();b.isNode=Boolean(typeof globalThis!="undefined"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);b.global=b.isNode&&globalThis||typeof window!="undefined"&&window||typeof self!="undefined"&&self||Br;b.emptyArray=Object.freeze?Object.freeze([]):[];b.emptyObject=Object.freeze?Object.freeze({}):{};b.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};b.isString=function(e){return typeof e=="string"||e instanceof String};b.isObject=function(e){return e&&typeof e=="object"};b.isset=b.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};b.Buffer=function(){try{var r=b.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch(e){return null}}();b._Buffer_from=null;b._Buffer_allocUnsafe=null;b.newBuffer=function(e){return typeof e=="number"?b.Buffer?b._Buffer_allocUnsafe(e):new b.Array(e):b.Buffer?b._Buffer_from(e):typeof Uint8Array=="undefined"?e:new Uint8Array(e)};b.Array=typeof Uint8Array!="undefined"?Uint8Array:Array;b.Long=b.global.dcodeIO&&b.global.dcodeIO.Long||b.global.Long||b.inquire("long");b.key2Re=/^true|false|0|1$/;b.key32Re=/^-?(?:0|[1-9][0-9]*)$/;b.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;b.longToHash=function(e){return e?b.LongBits.from(e).toHash():b.LongBits.zeroHash};b.longFromHash=function(e,t){var n=b.LongBits.fromHash(e);return b.Long?b.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))};function Ji(r,e,t){for(var n=Object.keys(e),i=0;i<n.length;++i)(r[n[i]]===void 0||!t)&&(r[n[i]]=e[n[i]]);return r}b.merge=Ji;b.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function Qi(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&Ji(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return r}}),e.prototype.toString=function(){return this.name+": "+this.message},e}b.newError=Qi;b.ProtocolError=Qi("ProtocolError");b.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};b.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};b.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};b._configure=function(){var r=b.Buffer;if(!r){b._Buffer_from=b._Buffer_allocUnsafe=null;return}b._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},b._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var Fr=g((sd,Yi)=>{u();"use strict";Yi.exports=B;var J=ve(),Er,Pt=J.LongBits,Ki=J.base64,Xi=J.utf8;function ut(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function kr(){}function $l(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function B(){this.len=0,this.head=new ut(kr,0,0),this.tail=this.head,this.states=null}var Zi=function(){return J.Buffer?function(){return(B.create=function(){return new Er})()}:function(){return new B}};B.create=Zi();B.alloc=function(e){return new J.Array(e)};J.Array!==Array&&(B.alloc=J.pool(B.alloc,J.Array.prototype.subarray));B.prototype._push=function(e,t,n){return this.tail=this.tail.next=new ut(e,t,n),this.len+=t,this};function Ar(r,e,t){e[t]=r&255}function Gl(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function Sr(r,e){this.len=r,this.next=void 0,this.val=e}Sr.prototype=Object.create(ut.prototype);Sr.prototype.fn=Gl;B.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Sr((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};B.prototype.int32=function(e){return e<0?this._push(Cr,10,Pt.fromNumber(e)):this.uint32(e)};B.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Cr(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}B.prototype.uint64=function(e){var t=Pt.from(e);return this._push(Cr,t.length(),t)};B.prototype.int64=B.prototype.uint64;B.prototype.sint64=function(e){var t=Pt.from(e).zzEncode();return this._push(Cr,t.length(),t)};B.prototype.bool=function(e){return this._push(Ar,1,e?1:0)};function Tr(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}B.prototype.fixed32=function(e){return this._push(Tr,4,e>>>0)};B.prototype.sfixed32=B.prototype.fixed32;B.prototype.fixed64=function(e){var t=Pt.from(e);return this._push(Tr,4,t.lo)._push(Tr,4,t.hi)};B.prototype.sfixed64=B.prototype.fixed64;B.prototype.float=function(e){return this._push(J.float.writeFloatLE,4,e)};B.prototype.double=function(e){return this._push(J.float.writeDoubleLE,8,e)};var Vl=J.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};B.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Ar,1,0);if(J.isString(e)){var n=B.alloc(t=Ki.length(e));Ki.decode(e,n,0),e=n}return this.uint32(t)._push(Vl,t,e)};B.prototype.string=function(e){var t=Xi.length(e);return t?this.uint32(t)._push(Xi.write,t,e):this._push(Ar,1,0)};B.prototype.fork=function(){return this.states=new $l(this),this.head=this.tail=new ut(kr,0,0),this.len=0,this};B.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ut(kr,0,0),this.len=0),this};B.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};B.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};B._configure=function(r){Er=r,B.create=Zi(),Er._configure()}});var rs=g((od,ts)=>{u();"use strict";ts.exports=se;var es=Fr();(se.prototype=Object.create(es.prototype)).constructor=se;var Be=ve();function se(){es.call(this)}se._configure=function(){se.alloc=Be._Buffer_allocUnsafe,se.writeBytesBuffer=Be.Buffer&&Be.Buffer.prototype instanceof Uint8Array&&Be.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}};se.prototype.bytes=function(e){Be.isString(e)&&(e=Be._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(se.writeBytesBuffer,t,e),this};function Jl(r,e,t){r.length<40?Be.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}se.prototype.string=function(e){var t=Be.Buffer.byteLength(e);return this.uint32(t),t&&this._push(Jl,t,e),this};se._configure()});var Lr=g((ad,as)=>{u();"use strict";as.exports=P;var oe=ve(),Or,ns=oe.LongBits,Ql=oe.utf8;function Q(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function P(r){this.buf=r,this.pos=0,this.len=r.length}var is=typeof Uint8Array!="undefined"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new P(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new P(e);throw Error("illegal buffer")},ss=function(){return oe.Buffer?function(t){return(P.create=function(i){return oe.Buffer.isBuffer(i)?new Or(i):is(i)})(t)}:is};P.create=ss();P.prototype._slice=oe.Array.prototype.subarray||oe.Array.prototype.slice;P.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Q(this,10);return e}}();P.prototype.int32=function(){return this.uint32()|0};P.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Mr(){var r=new ns(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Q(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw Q(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}P.prototype.bool=function(){return this.uint32()!==0};function Dt(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}P.prototype.fixed32=function(){if(this.pos+4>this.len)throw Q(this,4);return Dt(this.buf,this.pos+=4)};P.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Q(this,4);return Dt(this.buf,this.pos+=4)|0};function os(){if(this.pos+8>this.len)throw Q(this,8);return new ns(Dt(this.buf,this.pos+=4),Dt(this.buf,this.pos+=4))}P.prototype.float=function(){if(this.pos+4>this.len)throw Q(this,4);var e=oe.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};P.prototype.double=function(){if(this.pos+8>this.len)throw Q(this,4);var e=oe.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};P.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Q(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};P.prototype.string=function(){var e=this.bytes();return Ql.read(e,0,e.length)};P.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Q(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Q(this);while(this.buf[this.pos++]&128);return this};P.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!=4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};P._configure=function(r){Or=r,P.create=ss(),Or._configure();var e=oe.Long?"toLong":"toNumber";oe.merge(P.prototype,{int64:function(){return Mr.call(this)[e](!1)},uint64:function(){return Mr.call(this)[e](!0)},sint64:function(){return Mr.call(this).zzDecode()[e](!1)},fixed64:function(){return os.call(this)[e](!0)},sfixed64:function(){return os.call(this)[e](!1)}})}});var hs=g((cd,ls)=>{u();"use strict";ls.exports=Me;var cs=Lr();(Me.prototype=Object.create(cs.prototype)).constructor=Me;var us=ve();function Me(r){cs.call(this,r)}Me._configure=function(){us.Buffer&&(Me.prototype._slice=us.Buffer.prototype.slice)};Me.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Me._configure()});var ps=g((ud,fs)=>{u();"use strict";fs.exports=lt;var Ir=ve();(lt.prototype=Object.create(Ir.EventEmitter.prototype)).constructor=lt;function lt(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");Ir.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(t)}lt.prototype.rpcCall=function r(e,t,n,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return Ir.asPromise(r,o,e,t,n,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(c,l){if(c)return o.emit("error",c,e),s(c);if(l===null){o.end(!0);return}if(!(l instanceof n))try{l=n[o.responseDelimited?"decodeDelimited":"decode"](l)}catch(h){return o.emit("error",h,e),s(h)}return o.emit("data",l,e),s(null,l)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};lt.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var ys=g(ds=>{u();"use strict";var Kl=ds;Kl.Service=ps()});var ws=g((hd,gs)=>{u();"use strict";gs.exports={}});var _s=g(ms=>{u();"use strict";var H=ms;H.build="minimal";H.Writer=Fr();H.BufferWriter=rs();H.Reader=Lr();H.BufferReader=hs();H.util=ve();H.rpc=ys();H.roots=ws();H.configure=bs;function bs(){H.util._configure(),H.Writer._configure(H.BufferWriter),H.Reader._configure(H.BufferReader)}bs()});var vs=g((pd,xs)=>{u();"use strict";xs.exports=_s()});var Es=g((dd,Bs)=>{u();"use strict";var ae=vs(),ce=ae.Reader,ht=ae.Writer,E=ae.util,v=ae.roots["ipfs-bitswap"]||(ae.roots["ipfs-bitswap"]={});v.Message=function(){function r(e){if(this.blocks=[],this.payload=[],this.blockPresences=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.wantlist=null,r.prototype.blocks=E.emptyArray,r.prototype.payload=E.emptyArray,r.prototype.blockPresences=E.emptyArray,r.prototype.pendingBytes=0,r.encode=function(t,n){if(n||(n=ht.create()),t.wantlist!=null&&Object.hasOwnProperty.call(t,"wantlist")&&v.Message.Wantlist.encode(t.wantlist,n.uint32(10).fork()).ldelim(),t.blocks!=null&&t.blocks.length)for(var i=0;i<t.blocks.length;++i)n.uint32(18).bytes(t.blocks[i]);if(t.payload!=null&&t.payload.length)for(var i=0;i<t.payload.length;++i)v.Message.Block.encode(t.payload[i],n.uint32(26).fork()).ldelim();if(t.blockPresences!=null&&t.blockPresences.length)for(var i=0;i<t.blockPresences.length;++i)v.Message.BlockPresence.encode(t.blockPresences[i],n.uint32(34).fork()).ldelim();return t.pendingBytes!=null&&Object.hasOwnProperty.call(t,"pendingBytes")&&n.uint32(40).int32(t.pendingBytes),n},r.decode=function(t,n){t instanceof ce||(t=ce.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new v.Message;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.wantlist=v.Message.Wantlist.decode(t,t.uint32());break;case 2:s.blocks&&s.blocks.length||(s.blocks=[]),s.blocks.push(t.bytes());break;case 3:s.payload&&s.payload.length||(s.payload=[]),s.payload.push(v.Message.Block.decode(t,t.uint32()));break;case 4:s.blockPresences&&s.blockPresences.length||(s.blockPresences=[]),s.blockPresences.push(v.Message.BlockPresence.decode(t,t.uint32()));break;case 5:s.pendingBytes=t.int32();break;default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof v.Message)return t;var n=new v.Message;if(t.wantlist!=null){if(typeof t.wantlist!="object")throw TypeError(".Message.wantlist: object expected");n.wantlist=v.Message.Wantlist.fromObject(t.wantlist)}if(t.blocks){if(!Array.isArray(t.blocks))throw TypeError(".Message.blocks: array expected");n.blocks=[];for(var i=0;i<t.blocks.length;++i)typeof t.blocks[i]=="string"?E.base64.decode(t.blocks[i],n.blocks[i]=E.newBuffer(E.base64.length(t.blocks[i])),0):t.blocks[i].length&&(n.blocks[i]=t.blocks[i])}if(t.payload){if(!Array.isArray(t.payload))throw TypeError(".Message.payload: array expected");n.payload=[];for(var i=0;i<t.payload.length;++i){if(typeof t.payload[i]!="object")throw TypeError(".Message.payload: object expected");n.payload[i]=v.Message.Block.fromObject(t.payload[i])}}if(t.blockPresences){if(!Array.isArray(t.blockPresences))throw TypeError(".Message.blockPresences: array expected");n.blockPresences=[];for(var i=0;i<t.blockPresences.length;++i){if(typeof t.blockPresences[i]!="object")throw TypeError(".Message.blockPresences: object expected");n.blockPresences[i]=v.Message.BlockPresence.fromObject(t.blockPresences[i])}}return t.pendingBytes!=null&&(n.pendingBytes=t.pendingBytes|0),n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.blocks=[],i.payload=[],i.blockPresences=[]),n.defaults&&(i.wantlist=null,i.pendingBytes=0),t.wantlist!=null&&t.hasOwnProperty("wantlist")&&(i.wantlist=v.Message.Wantlist.toObject(t.wantlist,n)),t.blocks&&t.blocks.length){i.blocks=[];for(var s=0;s<t.blocks.length;++s)i.blocks[s]=n.bytes===String?E.base64.encode(t.blocks[s],0,t.blocks[s].length):n.bytes===Array?Array.prototype.slice.call(t.blocks[s]):t.blocks[s]}if(t.payload&&t.payload.length){i.payload=[];for(var s=0;s<t.payload.length;++s)i.payload[s]=v.Message.Block.toObject(t.payload[s],n)}if(t.blockPresences&&t.blockPresences.length){i.blockPresences=[];for(var s=0;s<t.blockPresences.length;++s)i.blockPresences[s]=v.Message.BlockPresence.toObject(t.blockPresences[s],n)}return t.pendingBytes!=null&&t.hasOwnProperty("pendingBytes")&&(i.pendingBytes=t.pendingBytes),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,ae.util.toJSONOptions)},r.Wantlist=function(){function e(t){if(this.entries=[],t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.entries=E.emptyArray,e.prototype.full=!1,e.encode=function(n,i){if(i||(i=ht.create()),n.entries!=null&&n.entries.length)for(var s=0;s<n.entries.length;++s)v.Message.Wantlist.Entry.encode(n.entries[s],i.uint32(10).fork()).ldelim();return n.full!=null&&Object.hasOwnProperty.call(n,"full")&&i.uint32(16).bool(n.full),i},e.decode=function(n,i){n instanceof ce||(n=ce.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new v.Message.Wantlist;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.entries&&o.entries.length||(o.entries=[]),o.entries.push(v.Message.Wantlist.Entry.decode(n,n.uint32()));break;case 2:o.full=n.bool();break;default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof v.Message.Wantlist)return n;var i=new v.Message.Wantlist;if(n.entries){if(!Array.isArray(n.entries))throw TypeError(".Message.Wantlist.entries: array expected");i.entries=[];for(var s=0;s<n.entries.length;++s){if(typeof n.entries[s]!="object")throw TypeError(".Message.Wantlist.entries: object expected");i.entries[s]=v.Message.Wantlist.Entry.fromObject(n.entries[s])}}return n.full!=null&&(i.full=Boolean(n.full)),i},e.toObject=function(n,i){i||(i={});var s={};if((i.arrays||i.defaults)&&(s.entries=[]),i.defaults&&(s.full=!1),n.entries&&n.entries.length){s.entries=[];for(var o=0;o<n.entries.length;++o)s.entries[o]=v.Message.Wantlist.Entry.toObject(n.entries[o],i)}return n.full!=null&&n.hasOwnProperty("full")&&(s.full=n.full),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,ae.util.toJSONOptions)},e.WantType=function(){var t={},n=Object.create(t);return n[t[0]="Block"]=0,n[t[1]="Have"]=1,n}(),e.Entry=function(){function t(n){if(n)for(var i=Object.keys(n),s=0;s<i.length;++s)n[i[s]]!=null&&(this[i[s]]=n[i[s]])}return t.prototype.block=E.newBuffer([]),t.prototype.priority=0,t.prototype.cancel=!1,t.prototype.wantType=0,t.prototype.sendDontHave=!1,t.encode=function(i,s){return s||(s=ht.create()),i.block!=null&&Object.hasOwnProperty.call(i,"block")&&s.uint32(10).bytes(i.block),i.priority!=null&&Object.hasOwnProperty.call(i,"priority")&&s.uint32(16).int32(i.priority),i.cancel!=null&&Object.hasOwnProperty.call(i,"cancel")&&s.uint32(24).bool(i.cancel),i.wantType!=null&&Object.hasOwnProperty.call(i,"wantType")&&s.uint32(32).int32(i.wantType),i.sendDontHave!=null&&Object.hasOwnProperty.call(i,"sendDontHave")&&s.uint32(40).bool(i.sendDontHave),s},t.decode=function(i,s){i instanceof ce||(i=ce.create(i));for(var o=s===void 0?i.len:i.pos+s,a=new v.Message.Wantlist.Entry;i.pos<o;){var c=i.uint32();switch(c>>>3){case 1:a.block=i.bytes();break;case 2:a.priority=i.int32();break;case 3:a.cancel=i.bool();break;case 4:a.wantType=i.int32();break;case 5:a.sendDontHave=i.bool();break;default:i.skipType(c&7);break}}return a},t.fromObject=function(i){if(i instanceof v.Message.Wantlist.Entry)return i;var s=new v.Message.Wantlist.Entry;switch(i.block!=null&&(typeof i.block=="string"?E.base64.decode(i.block,s.block=E.newBuffer(E.base64.length(i.block)),0):i.block.length&&(s.block=i.block)),i.priority!=null&&(s.priority=i.priority|0),i.cancel!=null&&(s.cancel=Boolean(i.cancel)),i.wantType){case"Block":case 0:s.wantType=0;break;case"Have":case 1:s.wantType=1;break}return i.sendDontHave!=null&&(s.sendDontHave=Boolean(i.sendDontHave)),s},t.toObject=function(i,s){s||(s={});var o={};return s.defaults&&(s.bytes===String?o.block="":(o.block=[],s.bytes!==Array&&(o.block=E.newBuffer(o.block))),o.priority=0,o.cancel=!1,o.wantType=s.enums===String?"Block":0,o.sendDontHave=!1),i.block!=null&&i.hasOwnProperty("block")&&(o.block=s.bytes===String?E.base64.encode(i.block,0,i.block.length):s.bytes===Array?Array.prototype.slice.call(i.block):i.block),i.priority!=null&&i.hasOwnProperty("priority")&&(o.priority=i.priority),i.cancel!=null&&i.hasOwnProperty("cancel")&&(o.cancel=i.cancel),i.wantType!=null&&i.hasOwnProperty("wantType")&&(o.wantType=s.enums===String?v.Message.Wantlist.WantType[i.wantType]:i.wantType),i.sendDontHave!=null&&i.hasOwnProperty("sendDontHave")&&(o.sendDontHave=i.sendDontHave),o},t.prototype.toJSON=function(){return this.constructor.toObject(this,ae.util.toJSONOptions)},t}(),e}(),r.Block=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.prefix=E.newBuffer([]),e.prototype.data=E.newBuffer([]),e.encode=function(n,i){return i||(i=ht.create()),n.prefix!=null&&Object.hasOwnProperty.call(n,"prefix")&&i.uint32(10).bytes(n.prefix),n.data!=null&&Object.hasOwnProperty.call(n,"data")&&i.uint32(18).bytes(n.data),i},e.decode=function(n,i){n instanceof ce||(n=ce.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new v.Message.Block;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.prefix=n.bytes();break;case 2:o.data=n.bytes();break;default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof v.Message.Block)return n;var i=new v.Message.Block;return n.prefix!=null&&(typeof n.prefix=="string"?E.base64.decode(n.prefix,i.prefix=E.newBuffer(E.base64.length(n.prefix)),0):n.prefix.length&&(i.prefix=n.prefix)),n.data!=null&&(typeof n.data=="string"?E.base64.decode(n.data,i.data=E.newBuffer(E.base64.length(n.data)),0):n.data.length&&(i.data=n.data)),i},e.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.prefix="":(s.prefix=[],i.bytes!==Array&&(s.prefix=E.newBuffer(s.prefix))),i.bytes===String?s.data="":(s.data=[],i.bytes!==Array&&(s.data=E.newBuffer(s.data)))),n.prefix!=null&&n.hasOwnProperty("prefix")&&(s.prefix=i.bytes===String?E.base64.encode(n.prefix,0,n.prefix.length):i.bytes===Array?Array.prototype.slice.call(n.prefix):n.prefix),n.data!=null&&n.hasOwnProperty("data")&&(s.data=i.bytes===String?E.base64.encode(n.data,0,n.data.length):i.bytes===Array?Array.prototype.slice.call(n.data):n.data),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,ae.util.toJSONOptions)},e}(),r.BlockPresenceType=function(){var e={},t=Object.create(e);return t[e[0]="Have"]=0,t[e[1]="DontHave"]=1,t}(),r.BlockPresence=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.cid=E.newBuffer([]),e.prototype.type=0,e.encode=function(n,i){return i||(i=ht.create()),n.cid!=null&&Object.hasOwnProperty.call(n,"cid")&&i.uint32(10).bytes(n.cid),n.type!=null&&Object.hasOwnProperty.call(n,"type")&&i.uint32(16).int32(n.type),i},e.decode=function(n,i){n instanceof ce||(n=ce.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new v.Message.BlockPresence;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.cid=n.bytes();break;case 2:o.type=n.int32();break;default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof v.Message.BlockPresence)return n;var i=new v.Message.BlockPresence;switch(n.cid!=null&&(typeof n.cid=="string"?E.base64.decode(n.cid,i.cid=E.newBuffer(E.base64.length(n.cid)),0):n.cid.length&&(i.cid=n.cid)),n.type){case"Have":case 0:i.type=0;break;case"DontHave":case 1:i.type=1;break}return i},e.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.cid="":(s.cid=[],i.bytes!==Array&&(s.cid=E.newBuffer(s.cid))),s.type=i.enums===String?"Have":0),n.cid!=null&&n.hasOwnProperty("cid")&&(s.cid=i.bytes===String?E.base64.encode(n.cid,0,n.cid.length):i.bytes===Array?Array.prototype.slice.call(n.cid):n.cid),n.type!=null&&n.hasOwnProperty("type")&&(s.type=i.enums===String?v.Message.BlockPresenceType[n.type]:n.type),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,ae.util.toJSONOptions)},e}(),r}();Bs.exports=v});var As=g((yd,ks)=>{u();"use strict";function Xl(r,e){e||(e=r.reduce((i,s)=>i+s.length,0));let t=new Uint8Array(e),n=0;for(let i of r)t.set(i,n),n+=i.length;return t}ks.exports=Xl});var Pr=g((gd,Cs)=>{u();"use strict";function Ss(r,e){for(let t in e)Object.defineProperty(r,t,{value:e[t],enumerable:!0,configurable:!0});return r}function Zl(r,e,t){if(!r||typeof r=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return Ss(r,t)}catch(n){t.message=r.message,t.stack=r.stack;let i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(r)),Ss(new i,t)}}Cs.exports=Zl});var Je=g((wd,Fs)=>{u();"use strict";var{CID:Ke}=(Tt(),Ct),{sha256:Dr}=(Qn(),Jn),{base58btc:ft}=(me(),Te),Yl=ui(),{isMapEqual:qr}=_e(),{Message:ye}=Es(),Ts=_r(),eh=As(),th=Pr(),j=class{constructor(e){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}get empty(){return this.blocks.size===0&&this.wantlist.size===0&&this.blockPresences.size===0}addEntry(e,t,n,i,s){n==null&&(n=j.WantType.Block);let o=e.toString(ft),a=this.wantlist.get(o);a?(a.wantType===n&&(a.priority=t),i&&(a.cancel=Boolean(i)),s&&(a.sendDontHave=Boolean(s)),n===j.WantType.Block&&a.wantType===j.WantType.Have&&(a.wantType=n)):this.wantlist.set(o,new Ts(e,t,n,i,s))}addBlock(e,t){let n=e.toString(ft);this.blocks.set(n,t)}addHave(e){let t=e.toString(ft);this.blockPresences.has(t)||this.blockPresences.set(t,j.BlockPresenceType.Have)}addDontHave(e){let t=e.toString(ft);this.blockPresences.has(t)||this.blockPresences.set(t,j.BlockPresenceType.DontHave)}cancel(e){let t=e.toString(ft);this.wantlist.delete(t),this.addEntry(e,0,j.WantType.Block,!0,!1)}setPendingBytes(e){this.pendingBytes=e}serializeToBitswap100(){let e={wantlist:{entries:Array.from(this.wantlist.values()).map(t=>({block:t.cid.bytes,priority:Number(t.priority),cancel:Boolean(t.cancel)})),full:this.full?!0:void 0},blocks:Array.from(this.blocks.values())};return ye.encode(e).finish()}serializeToBitswap110(){let e={wantlist:{entries:Array.from(this.wantlist.values()).map(t=>({block:t.cid.bytes,priority:Number(t.priority),wantType:t.wantType,cancel:Boolean(t.cancel),sendDontHave:Boolean(t.sendDontHave)})),full:this.full?!0:void 0},blockPresences:[],payload:[],pendingBytes:this.pendingBytes};for(let[t,n]of this.blocks.entries()){let i=Ke.parse(t),s=Uint8Array.from([i.code]),o=i.multihash.bytes.subarray(0,2),a=eh([[i.version],s,o],1+s.byteLength+o.byteLength);e.payload.push(new ye.Block({prefix:a,data:n}))}for(let[t,n]of this.blockPresences)e.blockPresences.push(new ye.BlockPresence({cid:Ke.parse(t).bytes,type:n}));return this.pendingBytes>0&&(e.pendingBytes=this.pendingBytes),ye.encode(e).finish()}equals(e){return!(this.full!==e.full||this.pendingBytes!==e.pendingBytes||!qr(this.wantlist,e.wantlist)||!qr(this.blocks,e.blocks)||!qr(this.blockPresences,e.blockPresences))}get[Symbol.toStringTag](){let e=Array.from(this.wantlist.keys()),t=Array.from(this.blocks.keys());return`BitswapMessage <full: ${this.full}, list: ${e}, blocks: ${t}>`}};j.deserialize=async(r,e={})=>{let t=ye.decode(r),n=t.wantlist&&t.wantlist.full||!1,i=new j(n);return t.wantlist&&t.wantlist.entries&&t.wantlist.entries.forEach(s=>{if(!s.block)return;let o=Ke.decode(s.block);i.addEntry(o,s.priority||0,s.wantType,Boolean(s.cancel),Boolean(s.sendDontHave))}),t.blockPresences&&t.blockPresences.forEach(s=>{if(!s.cid)return;let o=Ke.decode(s.cid);s.type===j.BlockPresenceType.Have?i.addHave(o):i.addDontHave(o)}),t.blocks.length>0?(await Promise.all(t.blocks.map(async s=>{let o=await Dr.digest(s),a=Ke.createV0(o);i.addBlock(a,s)})),i):(t.payload.length>0&&(await Promise.all(t.payload.map(async s=>{if(!s.prefix||!s.data)return;let o=Yl(s.prefix),a=o[0],c=o[1],l=o[2],h=l===Dr.code?Dr:e[l];if(!h)throw th(new Error("Unknown hash algorithm"),"ERR_UNKNOWN_HASH_ALG");let p=await h.digest(s.data),m=Ke.create(a,c,p);i.addBlock(m,s.data)})),i.setPendingBytes(t.pendingBytes)),i)};j.blockPresenceSize=r=>r.bytes.length+1;j.Entry=Ts;j.WantType={Block:ye.Wantlist.WantType.Block,Have:ye.Wantlist.WantType.Have};j.BlockPresenceType={Have:ye.BlockPresenceType.Have,DontHave:ye.BlockPresenceType.DontHave};Fs.exports=j});var pt=g((bd,Os)=>{u();"use strict";var Nr=1e3;Os.exports={maxProvidersPerRequest:3,providerRequestTimeout:10*Nr,hasBlockTimeout:15*Nr,provideTimeout:15*Nr,kMaxPriority:Math.pow(2,31)-1,maxListeners:1e3,wantlistSendDebounceMs:1}});var Ls=g((md,Ms)=>{u();Ms.exports=rh;function rh(r,e,t){var n=null,i=null,s=function(){n&&(clearTimeout(n),i=null,n=null)},o=function(){var c=i;s(),c&&c()},a=function(){if(!e)return r.apply(this,arguments);var c=this,l=arguments,h=t&&!n;if(s(),i=function(){r.apply(c,l)},n=setTimeout(function(){if(n=null,!h){var p=i;return i=null,p()}},e),h)return i()};return a.cancel=s,a.flush=o,a}});var Ps=g((xd,Is)=>{u();"use strict";var nh=Ls(),ih=Je(),sh=_e().logger,{wantlistSendDebounceMs:oh}=pt();Is.exports=class{constructor(e,t,n){this.peerId=t,this.network=n,this.refcnt=1,this._entries=[],this._log=sh(e,"msgqueue"),this.sendEntries=nh(this._sendEntries.bind(this),oh)}addMessage(e){e.empty||this.send(e)}addEntries(e){this._entries=this._entries.concat(e),this.sendEntries()}_sendEntries(){if(!this._entries.length)return;let e=new ih(!1);this._entries.forEach(t=>{t.cancel?e.cancel(t.cid):e.addEntry(t.cid,t.priority)}),this._entries=[],this.addMessage(e)}async send(e){try{await this.network.connectTo(this.peerId)}catch(t){this._log.error("cant connect to peer %s: %s",this.peerId.toB58String(),t.message);return}this._log("sending message to peer %s",this.peerId.toB58String()),this.network.sendMessage(this.peerId,e).catch(t=>{this._log.error("send error: %s",t.message)})}}});var qs=g((Bd,Ds)=>{u();"use strict";var Ur=Je(),ah=at(),ch=pt(),uh=Ps(),lh=_e().logger,{base58btc:hh}=(me(),Te);Ds.exports=class{constructor(e,t,n){this.peers=new Map,this.wantlist=new ah(n),this.network=t,this._stats=n,this._peerId=e,this._log=lh(e,"want")}_addEntries(e,t,n){let i=e.map((s,o)=>new Ur.Entry(s,ch.kMaxPriority-o,Ur.WantType.Block,t));i.forEach(s=>{s.cancel?n?this.wantlist.removeForce(s.cid.toString(hh)):this.wantlist.remove(s.cid):(this._log("adding to wl"),this.wantlist.add(s.cid,s.priority))});for(let s of this.peers.values())s.addEntries(i)}_startPeerHandler(e){let t=this.peers.get(e.toB58String());if(t){t.refcnt++;return}t=new uh(this._peerId,e,this.network);let n=new Ur(!0);for(let i of this.wantlist.entries())n.addEntry(i[1].cid,i[1].priority);return t.addMessage(n),this.peers.set(e.toB58String(),t),t}_stopPeerHandler(e){let t=this.peers.get(e.toB58String());!t||(t.refcnt--,!(t.refcnt>0)&&this.peers.delete(e.toB58String()))}wantBlocks(e,t={}){this._addEntries(e,!1),t&&t.signal&&t.signal.addEventListener("abort",()=>{this.cancelWants(e)})}unwantBlocks(e){this._log("unwant blocks: %s",e.length),this._addEntries(e,!0,!0)}cancelWants(e){this._log("cancel wants: %s",e.length),this._addEntries(e,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(e){this._startPeerHandler(e)}disconnected(e){this._stopPeerHandler(e)}start(){}stop(){this.peers.forEach(e=>this.disconnected(e.peerId))}}});var Rr=g((Ed,Us)=>{u();"use strict";var{Buffer:K}=be(),Ns=Symbol.for("BufferList");function M(r){if(!(this instanceof M))return new M(r);M._init.call(this,r)}M._init=function(e){Object.defineProperty(this,Ns,{value:!0}),this._bufs=[],this.length=0,e&&this.append(e)};M.prototype._new=function(e){return new M(e)};M.prototype._offset=function(e){if(e===0)return[0,0];let t=0;for(let n=0;n<this._bufs.length;n++){let i=t+this._bufs[n].length;if(e<i||n===this._bufs.length-1)return[n,e-t];t=i}};M.prototype._reverseOffset=function(r){let e=r[0],t=r[1];for(let n=0;n<e;n++)t+=this._bufs[n].length;return t};M.prototype.get=function(e){if(e>this.length||e<0)return;let t=this._offset(e);return this._bufs[t[0]][t[1]]};M.prototype.slice=function(e,t){return typeof e=="number"&&e<0&&(e+=this.length),typeof t=="number"&&t<0&&(t+=this.length),this.copy(null,0,e,t)};M.prototype.copy=function(e,t,n,i){if((typeof n!="number"||n<0)&&(n=0),(typeof i!="number"||i>this.length)&&(i=this.length),n>=this.length||i<=0)return e||K.alloc(0);let s=!!e,o=this._offset(n),a=i-n,c=a,l=s&&t||0,h=o[1];if(n===0&&i===this.length){if(!s)return this._bufs.length===1?this._bufs[0]:K.concat(this._bufs,this.length);for(let p=0;p<this._bufs.length;p++)this._bufs[p].copy(e,l),l+=this._bufs[p].length;return e}if(c<=this._bufs[o[0]].length-h)return s?this._bufs[o[0]].copy(e,t,h,h+c):this._bufs[o[0]].slice(h,h+c);s||(e=K.allocUnsafe(a));for(let p=o[0];p<this._bufs.length;p++){let m=this._bufs[p].length-h;if(c>m)this._bufs[p].copy(e,l,h),l+=m;else{this._bufs[p].copy(e,l,h,h+c),l+=m;break}c-=m,h&&(h=0)}return e.length>l?e.slice(0,l):e};M.prototype.shallowSlice=function(e,t){if(e=e||0,t=typeof t!="number"?this.length:t,e<0&&(e+=this.length),t<0&&(t+=this.length),e===t)return this._new();let n=this._offset(e),i=this._offset(t),s=this._bufs.slice(n[0],i[0]+1);return i[1]===0?s.pop():s[s.length-1]=s[s.length-1].slice(0,i[1]),n[1]!==0&&(s[0]=s[0].slice(n[1])),this._new(s)};M.prototype.toString=function(e,t,n){return this.slice(t,n).toString(e)};M.prototype.consume=function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;)if(e>=this._bufs[0].length)e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}return this};M.prototype.duplicate=function(){let e=this._new();for(let t=0;t<this._bufs.length;t++)e.append(this._bufs[t]);return e};M.prototype.append=function(e){if(e==null)return this;if(e.buffer)this._appendBuffer(K.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e))for(let t=0;t<e.length;t++)this.append(e[t]);else if(this._isBufferList(e))for(let t=0;t<e._bufs.length;t++)this.append(e._bufs[t]);else typeof e=="number"&&(e=e.toString()),this._appendBuffer(K.from(e));return this};M.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length};M.prototype.indexOf=function(r,e,t){if(t===void 0&&typeof e=="string"&&(t=e,e=void 0),typeof r=="function"||Array.isArray(r))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof r=="number"?r=K.from([r]):typeof r=="string"?r=K.from(r,t):this._isBufferList(r)?r=r.slice():Array.isArray(r.buffer)?r=K.from(r.buffer,r.byteOffset,r.byteLength):K.isBuffer(r)||(r=K.from(r)),e=Number(e||0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),r.length===0)return e>this.length?this.length:e;let n=this._offset(e),i=n[0],s=n[1];for(;i<this._bufs.length;i++){let o=this._bufs[i];for(;s<o.length;)if(o.length-s>=r.length){let c=o.indexOf(r,s);if(c!==-1)return this._reverseOffset([i,c]);s=o.length-r.length+1}else{let c=this._reverseOffset([i,s]);if(this._match(c,r))return c;s++}s=0}return-1};M.prototype._match=function(r,e){if(this.length-r<e.length)return!1;for(let t=0;t<e.length;t++)if(this.get(r+t)!==e[t])return!1;return!0};(function(){let r={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(let e in r)(function(t){r[t]===null?M.prototype[t]=function(n,i){return this.slice(n,n+i)[t](0,i)}:M.prototype[t]=function(n=0){return this.slice(n,n+r[t])[t](0)}})(e)})();M.prototype._isBufferList=function(e){return e instanceof M||M.isBufferList(e)};M.isBufferList=function(e){return e!=null&&e[Ns]};Us.exports=M});var zs=g((kd,js)=>{u();js.exports=jr;var Rs=128,fh=127,ph=~fh,dh=Math.pow(2,31);function jr(r,e,t){if(Number.MAX_SAFE_INTEGER&&r>Number.MAX_SAFE_INTEGER)throw jr.bytes=0,new RangeError("Could not encode varint");e=e||[],t=t||0;for(var n=t;r>=dh;)e[t++]=r&255|Rs,r/=128;for(;r&ph;)e[t++]=r&255|Rs,r>>>=7;return e[t]=r|0,jr.bytes=t-n+1,e}});var $s=g((Ad,Hs)=>{u();Hs.exports=zr;var yh=128,Ws=127;function zr(r,e){var t=0,e=e||0,n=0,i=e,s,o=r.length;do{if(i>=o||n>49)throw zr.bytes=0,new RangeError("Could not decode varint");s=r[i++],t+=n<28?(s&Ws)<<n:(s&Ws)*Math.pow(2,n),n+=7}while(s>=yh);return zr.bytes=i-e,t}});var Vs=g((Sd,Gs)=>{u();var gh=Math.pow(2,7),wh=Math.pow(2,14),bh=Math.pow(2,21),mh=Math.pow(2,28),_h=Math.pow(2,35),xh=Math.pow(2,42),vh=Math.pow(2,49),Bh=Math.pow(2,56),Eh=Math.pow(2,63);Gs.exports=function(r){return r<gh?1:r<wh?2:r<bh?3:r<mh?4:r<_h?5:r<xh?6:r<vh?7:r<Bh?8:r<Eh?9:10}});var Wr=g((Cd,Js)=>{u();Js.exports={encode:zs(),decode:$s(),encodingLength:Vs()}});var Hr=g((Td,Xs)=>{u();"use strict";var Qs=Wr(),{Buffer:kh}=be(),Ks=(r,e,t)=>{let n=Qs.encode(r,e,t);return Ks.bytes=Qs.encode.bytes,e||kh.from(n)};Xs.exports=Ks});var no=g((Fd,qt)=>{u();"use strict";var{Buffer:Zs}=be(),Ys=Rr(),eo=Hr(),$r=8,to=10*1024;function ro(r){r=r||{};let e=Math.max(r.poolSize||to,r.minPoolSize||$r),t=r.lengthEncoder||eo;return async function*(i){let s=Zs.alloc(e),o=0;for await(let a of i){t(a.length,s,o);let c=s.slice(o,o+t.bytes);o+=t.bytes,s.length-o<$r&&(s=Zs.alloc(e),o=0),yield new Ys().append(c).append(a)}}}ro.single=(r,e)=>{e=e||{};let t=e.lengthEncoder||eo;return new Ys([t(r.length),r.slice()])};qt.exports=ro;qt.exports.MIN_POOL_SIZE=$r;qt.exports.DEFAULT_POOL_SIZE=to});var Gr=g((Od,oo)=>{u();"use strict";var io=Wr(),{Buffer:Ah}=be(),Sh=r=>new Proxy({},{get:(e,t)=>t[0]==="l"?r[t]:r.get(parseInt(t))}),so=r=>{let e=io.decode(Ah.isBuffer(r)?r:Sh(r));return so.bytes=io.decode.bytes,e};oo.exports=so});var lo=g((Md,Nt)=>{u();"use strict";var{Buffer:Ch}=be(),Vr=Rr(),Th=Gr(),ao=8,co=1024*1024*4,uo=Ch.alloc(0),Ee={LENGTH:"readLength",DATA:"readData"},Fh={[Ee.LENGTH]:(r,e,t,n)=>{e=e.append(r);let i;try{i=n.lengthDecoder(e)}catch(s){if(e.length>n.maxLengthLength)throw Object.assign(s,{message:"message length too long",code:"ERR_MSG_LENGTH_TOO_LONG"});if(s instanceof RangeError)return{mode:Ee.LENGTH,buffer:e,chunk:void 0,state:void 0,data:void 0};throw s}if(i>n.maxDataLength)throw Object.assign(new Error("message data too long"),{code:"ERR_MSG_DATA_TOO_LONG"});return r=e.shallowSlice(n.lengthDecoder.bytes),e=new Vr,n.onLength&&n.onLength(i),i<=0?(n.onData&&n.onData(uo),{mode:Ee.LENGTH,chunk:r,buffer:e,data:uo}):{mode:Ee.DATA,chunk:r,buffer:e,state:{dataLength:i},data:void 0}},[Ee.DATA]:(r,e,t,n)=>{if(e=e.append(r),!t)throw new Error("state is required");if(e.length<t.dataLength)return{mode:Ee.DATA,buffer:e,state:t,chunk:void 0,data:void 0};let{dataLength:i}=t,s=e.shallowSlice(0,i),o=e.length>i?e.shallowSlice(i):void 0;return e=new Vr,n.onData&&n.onData(s),{mode:Ee.LENGTH,chunk:o,buffer:e,state:void 0,data:s}}};function Jr(r){r=r||{};let e={lengthDecoder:r.lengthDecoder||Th,maxLengthLength:r.maxLengthLength||ao,maxDataLength:r.maxDataLength||co,onLength:r.onLength,onData:r.onData};return async function*(n){let i=new Vr,s=Ee.LENGTH,o;for await(let a of n){let c=a;for(;c;){let l=Fh[s](c,i,o,e);s=l.mode,c=l.chunk,i=l.buffer,o=l.state,l.data&&(yield l.data)}}if(i.length)throw Object.assign(new Error("unexpected end of input"),{code:"ERR_UNEXPECTED_EOF"})}}Jr.fromReader=(r,e)=>{let t=1,n={[Symbol.asyncIterator](){return this},next:async()=>{try{return await r.next(t)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}};return Jr({...e||{},onLength:s=>{t=s}})(n)};Nt.exports=Jr;Nt.exports.MAX_LENGTH_LENGTH=ao;Nt.exports.MAX_DATA_LENGTH=co});var po=g((Ld,fo)=>{u();"use strict";var{Buffer:Oh}=be(),ho=(r,e,t)=>(e=e||Oh.allocUnsafe(4),e.writeInt32BE(r,t),e);ho.bytes=4;fo.exports=ho});var wo=g((Id,go)=>{u();"use strict";var yo=r=>{if(r.length<4)throw RangeError("Could not decode int32BE");return r.readInt32BE(0)};yo.bytes=4;go.exports=yo});var bo=g(Le=>{u();"use strict";Le.encode=no();Le.decode=lo();Le.varintEncode=Hr();Le.varintDecode=Gr();Le.int32BEEncode=po();Le.int32BEDecode=wo()});var xo=g((Dd,Xe)=>{u();var mo=(...r)=>{let e;for(;r.length;)e=r.shift()(e);return e},Qr=r=>r&&(typeof r[Symbol.asyncIterator]=="function"||typeof r[Symbol.iterator]=="function"||typeof r.next=="function"),Ut=r=>r&&typeof r.sink=="function"&&Qr(r.source),Mh=r=>e=>(r.sink(e),r.source),_o=(...r)=>{if(Ut(r[0])){let e=r[0];r[0]=()=>e.source}else if(Qr(r[0])){let e=r[0];r[0]=()=>e}if(r.length>1&&Ut(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let e=1;e<r.length-1;e++)Ut(r[e])&&(r[e]=Mh(r[e]));return mo(...r)};Xe.exports=_o;Xe.exports.pipe=_o;Xe.exports.rawPipe=mo;Xe.exports.isIterable=Qr;Xe.exports.isDuplex=Ut});var Ao=g((qd,ko)=>{u();"use strict";var vo=()=>{},Bo=Symbol.for("@libp2p/js-interfaces/topology"),Eo=class{constructor({min:e=0,max:t=1/0,handlers:n={}}){this.min=e,this.max=t,this._onConnect=n.onConnect||vo,this._onDisconnect=n.onDisconnect||vo,this.peers=new Set}get[Symbol.toStringTag](){return"Topology"}get[Bo](){return!0}static isTopology(e){return Boolean(e&&e[Bo])}set registrar(e){this._registrar=e}disconnect(e){this._onDisconnect(e)}};ko.exports=Eo});var Fo=g((Nd,To)=>{u();"use strict";var Lh=Ao(),So=Symbol.for("@libp2p/js-interfaces/topology/multicodec-topology"),Co=class extends Lh{constructor({min:e,max:t,multicodecs:n,handlers:i}){super({min:e,max:t,handlers:i});if(!n)throw new Error("one or more multicodec should be provided");if(!i)throw new Error("the handlers should be provided");if(typeof i.onConnect!="function")throw new Error("the 'onConnect' handler must be provided");if(typeof i.onDisconnect!="function")throw new Error("the 'onDisconnect' handler must be provided");this.multicodecs=Array.isArray(n)?n:[n],this._registrar=void 0,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerConnect=this._onPeerConnect.bind(this)}get[Symbol.toStringTag](){return"Topology"}get[So](){return!0}static isMulticodecTopology(e){return Boolean(e&&e[So])}set registrar(e){this._registrar=e,this._registrar.peerStore.on("change:protocols",this._onProtocolChange),this._registrar.connectionManager.on("peer:connect",this._onPeerConnect),this._updatePeers(this._registrar.peerStore.peers.values())}_updatePeers(e){for(let{id:t,protocols:n}of e)if(this.multicodecs.filter(i=>n.includes(i)).length){this.peers.add(t.toB58String());let i=this._registrar.getConnection(t);i&&this._onConnect(t,i)}else this.peers.delete(t.toB58String())}_onProtocolChange({peerId:e,protocols:t}){let n=this.peers.has(e.toB58String()),i=t.filter(s=>this.multicodecs.includes(s));n&&i.length===0&&this._onDisconnect(e);for(let s of t)if(this.multicodecs.includes(s)){let o=this._registrar.peerStore.get(e);this._updatePeers([o]);return}}_onPeerConnect(e){let t=e.remotePeer,n=this._registrar.peerStore.protoBook.get(t);!n||this.multicodecs.find(i=>n.includes(i))&&(this.peers.add(t.toB58String()),this._onConnect(t,e))}};To.exports=Co});var Do=g((Ud,Po)=>{u();"use strict";var Oo=bo(),{pipe:Mo}=xo(),Ih=Fo(),Ph=Je(),Lo=pt(),Dh=_e().logger,Kr="/ipfs/bitswap/1.0.0",Xr="/ipfs/bitswap/1.1.0",Zr="/ipfs/bitswap/1.2.0",Io=class{constructor(e,t,n,i={}){this._log=Dh(e.peerId,"network"),this._libp2p=e,this._bitswap=t,this._protocols=[Kr],i.b100Only||(this._protocols.unshift(Xr),this._protocols.unshift(Zr)),this._stats=n,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this._hashers=i.hashers||{}}start(){this._running=!0,this._libp2p.handle(this._protocols,this._onConnection);let e=new Ih({multicodecs:this._protocols,handlers:{onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect}});this._registrarId=this._libp2p.registrar.register(e);for(let t of this._libp2p.peerStore.peers.values()){let n=this._libp2p.connectionManager.get(t.id);n&&this._onPeerConnect(n.remotePeer)}}stop(){this._running=!1,this._libp2p.unhandle(this._protocols),this._registrarId!=null&&this._libp2p.registrar.unregister(this._registrarId)}async _onConnection({protocol:e,stream:t,connection:n}){if(!!this._running){this._log("incoming new bitswap %s connection from %s",e,n.remotePeer.toB58String());try{await Mo(t,Oo.decode(),async i=>{for await(let s of i)try{let o=await Ph.deserialize(s.slice(),this._hashers);await this._bitswap._receiveMessage(n.remotePeer,o)}catch(o){this._bitswap._receiveError(o);break}})}catch(i){this._log(i)}}}_onPeerConnect(e){this._bitswap._onPeerConnected(e)}_onPeerDisconnect(e){this._bitswap._onPeerDisconnected(e)}findProviders(e,t,n={}){return this._libp2p.contentRouting.findProviders(e,{timeout:Lo.providerRequestTimeout,maxNumProviders:t})}async findAndConnect(e,t){let n=[];for await(let i of this.findProviders(e,Lo.maxProvidersPerRequest,t))this._log(`connecting to provider ${i.id}`),n.push(this.connectTo(i.id,t).catch(s=>{this._log.error(s)}));await Promise.all(n)}async provide(e,t){await this._libp2p.contentRouting.provide(e,t)}async sendMessage(e,t){if(!this._running)throw new Error("network isn't running");let n=e.toB58String();this._log("sendMessage to %s",n,t);let i=await this._libp2p.dial(e),{stream:s,protocol:o}=await i.newStream([Zr,Xr,Kr]),a;switch(o){case Kr:a=t.serializeToBitswap100();break;case Xr:case Zr:a=t.serializeToBitswap110();break;default:throw new Error("Unknown protocol: "+o)}qh(s,a,this._log),this._updateSentStats(e,t.blocks)}async connectTo(e,t){if(!this._running)throw new Error("network isn't running");return this._libp2p.dial(e,t)}_updateSentStats(e,t){let n=e.toB58String();if(this._stats){for(let i of t.values())this._stats.push(n,"dataSent",i.length);this._stats.push(n,"blocksSent",t.size)}}};async function qh(r,e,t){try{await Mo([e],Oo.encode(),r)}catch(n){t(n)}}Po.exports=Io});var Uo=g((Rd,No)=>{u();"use strict";var Nh=at(),qo=class{constructor(e){this.partner=e,this.wantlist=new Nh,this.exchangeCount=0,this.sentToPeer=new Map,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesRecv+=e}wants(e,t,n){this.wantlist.add(e,t,n)}cancelWant(e){this.wantlist.remove(e)}wantlistContains(e){return this.wantlist.get(e)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}};No.exports=qo});var zo=g((jd,jo)=>{u();"use strict";var Ro=class extends Map{constructor(e,t){super();this._cmp=t||this._defaultSort,this._keys=[];for(let[n,i]of e||[])this.set(n,i)}update(e){if(e<0||e>=this._keys.length)return;let t=this._keys[e];this._keys.splice(e,1);let n=this._find(t);this._keys.splice(n,0,t)}set(e,t){if(this.has(e)){let i=this.indexOf(e);this._keys.splice(i,1)}super.set(e,t);let n=this._find(e);return this._keys.splice(n,0,e),this}clear(){super.clear(),this._keys=[]}delete(e){if(!this.has(e))return!1;let t=this.indexOf(e);return this._keys.splice(t,1),super.delete(e)}indexOf(e){if(!this.has(e))return-1;let t=this._find(e);if(this._keys[t]===e)return t;for(let n=1;n<this._keys.length;n++){if(this._keys[t+n]===e)return t+n;if(this._keys[t-n]===e)return t-n}return-1}_find(e){let t=0,n=this._keys.length;for(;t<n;){let i=t+n>>>1,s=this._kCmp(this._keys[i],e);if(s<0)t=i+1;else if(s>0)n=i;else return i}return t}*keys(){for(let e of this._keys)yield e}*values(){for(let e of this._keys)yield this.get(e)}*entries(){for(let e of this._keys)yield[e,this.get(e)]}*[Symbol.iterator](){yield*this.entries()}forEach(e,t){if(!!e)for(let n of this._keys)e.apply(t,[[n,this.get(n)]])}_defaultSort(e,t){return e[0]<t[0]?-1:t[0]<e[0]?1:0}_kCmp(e,t){return this._cmp([e,this.get(e)],[t,this.get(t)])}};jo.exports=Ro});var Vo=g((zd,Go)=>{u();"use strict";var Wo=zo(),Uh={hasNewInfo(){return!1},merge(){}},Ho=class{constructor(e=Uh){this._taskMerger=e,this._byPeer=new Wo([],Yr.compare)}pushTasks(e,t){let n=this._byPeer.get(e.toB58String());n||(n=new Yr(e,this._taskMerger)),n.pushTasks(t),this._byPeer.set(e.toB58String(),n)}popTasks(e){let t=this._head();if(t===void 0)return{tasks:[],pendingSize:0};let{tasks:n,pendingSize:i}=t.popTasks(e);if(n.length===0)return{tasks:n,pendingSize:i};let s=t.peerId;return t.isIdle()?this._byPeer.delete(s.toB58String()):this._byPeer.update(0),{peerId:s,tasks:n,pendingSize:i}}_head(){if(this._byPeer.size!==0)for(let[,e]of this._byPeer)return e}remove(e,t){let n=this._byPeer.get(t.toB58String());n&&n.remove(e)}tasksDone(e,t){let n=this._byPeer.get(e.toB58String());if(!n)return;let i=this._byPeer.indexOf(e.toB58String());for(let s of t)n.taskDone(s);this._byPeer.update(i)}},Yr=class{constructor(e,t){this.peerId=e,this._taskMerger=t,this._activeTotalSize=0,this._pending=new $o,this._active=new Set}pushTasks(e){for(let t of e)this._pushTask(t)}_pushTask(e){if(!this._taskHasMoreInfoThanActiveTasks(e))return;let t=this._pending.get(e.topic);if(t){e.priority>t.priority&&this._pending.updatePriority(e.topic,e.priority),this._taskMerger.merge(e,t);return}this._pending.add(e)}_taskHasMoreInfoThanActiveTasks(e){let t=[];for(let n of this._active)n.topic===e.topic&&t.push(n);return t.length===0?!0:this._taskMerger.hasNewInfo(e,t)}popTasks(e){let t=0,n=[],i=this._pending.tasks();for(let s=0;s<i.length&&t<e;s++){let o=i[s];n.push(o),t+=o.size,this._pending.delete(o.topic),this._activeTotalSize+=o.size,this._active.add(o)}return{tasks:n,pendingSize:this._pending.totalSize}}taskDone(e){this._active.has(e)&&(this._activeTotalSize-=e.size,this._active.delete(e))}remove(e){this._pending.delete(e)}isIdle(){return this._pending.length===0&&this._active.size===0}static compare(e,t){return e[1]._pending.length===0?1:t[1]._pending.length===0?-1:e[1]._activeTotalSize===t[1]._activeTotalSize?t[1]._pending.length-e[1]._pending.length:e[1]._activeTotalSize-t[1]._activeTotalSize}},$o=class{constructor(){this._tasks=new Wo([],this._compare)}get length(){return this._tasks.size}get totalSize(){return[...this._tasks.values()].reduce((e,t)=>e+t.task.size,0)}get(e){return(this._tasks.get(e)||{}).task}add(e){this._tasks.set(e.topic,{created:Date.now(),task:e})}delete(e){this._tasks.delete(e)}tasks(){return[...this._tasks.values()].map(e=>e.task)}updatePriority(e,t){let n=this._tasks.get(e);if(!n)return;let i=this._tasks.indexOf(e);n.task.priority=t,this._tasks.update(i)}_compare(e,t){return e[1].task.priority===t[1].task.priority?e[1].created-t[1].created:t[1].task.priority-e[1].task.priority}};Go.exports=Ho});var Qo=g((Wd,Jo)=>{u();"use strict";var Rh={hasNewInfo(r,e){let t=!1,n=!1;for(let i of e)i.data.haveBlock&&(t=!0),i.data.isWantBlock&&(n=!0);return!!(!n&&r.data.isWantBlock||!t&&r.data.haveBlock)},merge(r,e){let t=r.data,n=e.data;!n.haveBlock&&t.haveBlock&&(n.haveBlock=t.haveBlock,n.blockSize=t.blockSize),!n.isWantBlock&&t.isWantBlock&&(n.isWantBlock=!0,(!n.haveBlock||t.haveBlock)&&(n.haveBlock=t.haveBlock,e.size=r.size)),n.isWantBlock&&n.haveBlock&&(e.size=n.blockSize)}};Jo.exports=Rh});var Yo=g((Hd,Zo)=>{u();"use strict";var{CID:en}=(Tt(),Ct),{base58btc:Rt}=(me(),Te),dt=Je(),Ko=dt.WantType,jh=at(),zh=Uo(),Wh=Vo(),Hh=Qo(),{logger:$h}=_e(),Gh=16*1024,Vh=1024,Xo=class{constructor(e,t,n,i,s={}){this._log=$h(e,"engine"),this.blockstore=t,this.network=n,this._stats=i,this._opts=this._processOpts(s),this.ledgerMap=new Map,this._running=!1,this._requestQueue=new Wh(Hh)}_processOpts(e){return{maxSizeReplaceHasWithBlock:Vh,targetMessageSize:Gh,...e}}_scheduleProcessTasks(){setTimeout(()=>{this._processTasks()})}async _processTasks(){if(!this._running)return;let{peerId:e,tasks:t,pendingSize:n}=this._requestQueue.popTasks(this._opts.targetMessageSize);if(t.length===0)return;let i=new dt(!1);i.setPendingBytes(n);let s=[],o=new Map;for(let c of t){let l=en.parse(c.topic);c.data.haveBlock?c.data.isWantBlock?(s.push(l),o.set(c.topic,c.data)):i.addHave(l):i.addDontHave(l)}let a=await this._getBlocks(s);for(let[c,l]of o){let h=en.parse(c),p=a.get(c);p?i.addBlock(h,p):l.sendDontHave&&i.addDontHave(h)}if(i.empty){e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks();return}try{e&&await this.network.sendMessage(e,i);for(let[c,l]of a.entries())e&&this.messageSent(e,en.parse(c),l)}catch(c){this._log.error(c)}e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks()}wantlistForPeer(e){let t=e.toB58String(),n=this.ledgerMap.get(t);return n?n.wantlist.sortedEntries():new Map}ledgerForPeer(e){let t=e.toB58String(),n=this.ledgerMap.get(t);return n?{peer:n.partner,value:n.debtRatio(),sent:n.accounting.bytesSent,recv:n.accounting.bytesRecv,exchanged:n.exchangeCount}:null}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.partner)}receivedBlocks(e){if(!!e.length){for(let t of this.ledgerMap.values())for(let n of e){let i=t.wantlistContains(n.cid);if(!i)continue;let s=n.data.length,o=this._sendAsBlock(i.wantType,s),a=s;o||(a=dt.blockPresenceSize(i.cid)),this._requestQueue.pushTasks(t.partner,[{topic:i.cid.toString(Rt),priority:i.priority,size:a,data:{blockSize:s,isWantBlock:o,haveBlock:!0,sendDontHave:!1}}])}this._scheduleProcessTasks()}}async messageReceived(e,t){let n=this._findOrCreate(e);if(t.empty)return;if(t.full&&(n.wantlist=new jh),this._updateBlockAccounting(t.blocks,n),t.wantlist.size===0){this._scheduleProcessTasks();return}let i=[],s=[];t.wantlist.forEach(o=>{o.cancel?(n.cancelWant(o.cid),i.push(o.cid)):(n.wants(o.cid,o.priority,o.wantType),s.push(o))}),this._cancelWants(e,i),await this._addWants(e,s),this._scheduleProcessTasks()}_cancelWants(e,t){for(let n of t)this._requestQueue.remove(n.toString(Rt),e)}async _addWants(e,t){let n=await this._getBlockSizes(t.map(s=>s.cid)),i=[];for(let s of t){let o=s.cid.toString(Rt),a=n.get(o);if(a==null)s.sendDontHave&&i.push({topic:o,priority:s.priority,size:dt.blockPresenceSize(s.cid),data:{isWantBlock:s.wantType===Ko.Block,blockSize:0,haveBlock:!1,sendDontHave:s.sendDontHave}});else{let c=this._sendAsBlock(s.wantType,a),l=a;c||(l=dt.blockPresenceSize(s.cid)),i.push({topic:o,priority:s.priority,size:l,data:{isWantBlock:c,blockSize:a,haveBlock:!0,sendDontHave:s.sendDontHave}})}this._requestQueue.pushTasks(e,i)}}_sendAsBlock(e,t){return e===Ko.Block||t<=this._opts.maxSizeReplaceHasWithBlock}async _getBlockSizes(e){let t=await this._getBlocks(e);return new Map([...t].map(([n,i])=>[n,i.length]))}async _getBlocks(e){let t=new Map;return await Promise.all(e.map(async n=>{try{let i=await this.blockstore.get(n);t.set(n.toString(Rt),i)}catch(i){i.code!=="ERR_NOT_FOUND"&&this._log.error("failed to query blockstore for %s: %s",n,i)}})),t}_updateBlockAccounting(e,t){for(let n of e.values())this._log("got block (%s bytes)",n.length),t.receivedBytes(n.length)}messageSent(e,t,n){let i=this._findOrCreate(e);i.sentBytes(n.length),i.wantlist.remove(t)}numBytesSentTo(e){return this._findOrCreate(e).accounting.bytesSent}numBytesReceivedFrom(e){return this._findOrCreate(e).accounting.bytesRecv}peerDisconnected(e){}_findOrCreate(e){let t=e.toB58String(),n=this.ledgerMap.get(t);if(n)return n;let i=new zh(e);return this.ledgerMap.set(t,i),this._stats&&this._stats.push(t,"peerCount",1),i}start(){this._running=!0}stop(){this._running=!1}};Zo.exports=Xo});var Wt=g(($d,tn)=>{u();"use strict";var Ze=typeof Reflect=="object"?Reflect:null,ea=Ze&&typeof Ze.apply=="function"?Ze.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},jt;Ze&&typeof Ze.ownKeys=="function"?jt=Ze.ownKeys:Object.getOwnPropertySymbols?jt=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:jt=function(e){return Object.getOwnPropertyNames(e)};function Jh(r){console&&console.warn&&console.warn(r)}var ta=Number.isNaN||function(e){return e!==e};function S(){S.init.call(this)}tn.exports=S;tn.exports.once=Zh;S.EventEmitter=S;S.prototype._events=void 0;S.prototype._eventsCount=0;S.prototype._maxListeners=void 0;var ra=10;function zt(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(S,"defaultMaxListeners",{enumerable:!0,get:function(){return ra},set:function(r){if(typeof r!="number"||r<0||ta(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");ra=r}});S.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};S.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||ta(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function na(r){return r._maxListeners===void 0?S.defaultMaxListeners:r._maxListeners}S.prototype.getMaxListeners=function(){return na(this)};S.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")ea(c,this,t);else for(var l=c.length,h=ca(c,l),n=0;n<l;++n)ea(h[n],this,t);return!0};function ia(r,e,t,n){var i,s,o;if(zt(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),o=s[e]),o===void 0)o=s[e]=t,++r._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),i=na(r),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=o.length,Jh(a)}return r}S.prototype.addListener=function(e,t){return ia(this,e,t,!1)};S.prototype.on=S.prototype.addListener;S.prototype.prependListener=function(e,t){return ia(this,e,t,!0)};function Qh(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function sa(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=Qh.bind(n);return i.listener=t,n.wrapFn=i,i}S.prototype.once=function(e,t){return zt(t),this.on(e,sa(this,e,t)),this};S.prototype.prependOnceListener=function(e,t){return zt(t),this.prependListener(e,sa(this,e,t)),this};S.prototype.removeListener=function(e,t){var n,i,s,o,a;if(zt(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount==0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():Kh(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};S.prototype.off=S.prototype.removeListener;S.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function oa(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?Xh(i):ca(i,i.length)}S.prototype.listeners=function(e){return oa(this,e,!0)};S.prototype.rawListeners=function(e){return oa(this,e,!1)};S.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):aa.call(r,e)};S.prototype.listenerCount=aa;function aa(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}S.prototype.eventNames=function(){return this._eventsCount>0?jt(this._events):[]};function ca(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function Kh(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function Xh(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function Zh(r,e){return new Promise(function(t,n){function i(o){r.removeListener(e,s),n(o)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}ua(r,e,s,{once:!0}),e!=="error"&&Yh(r,i,{once:!0})})}function Yh(r,e,t){typeof r.on=="function"&&ua(r,"error",e,t)}function ua(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(s){n.once&&r.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}});var ha=g((Gd,la)=>{u();"use strict";function ef(r){if(r.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),t=0;t<e.length;t++)e[t]=255;for(var n=0;n<r.length;n++){var i=r.charAt(n),s=i.charCodeAt(0);if(e[s]!==255)throw new TypeError(i+" is ambiguous");e[s]=n}var o=r.length,a=r.charAt(0),c=Math.log(o)/Math.log(256),l=Math.log(256)/Math.log(o);function h(w){if(w instanceof Uint8Array||(ArrayBuffer.isView(w)?w=new Uint8Array(w.buffer,w.byteOffset,w.byteLength):Array.isArray(w)&&(w=Uint8Array.from(w))),!(w instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(w.length===0)return"";for(var _=0,A=0,x=0,k=w.length;x!==k&&w[x]===0;)x++,_++;for(var F=(k-x)*l+1>>>0,C=new Uint8Array(F);x!==k;){for(var O=w[x],q=0,T=F-1;(O!==0||q<A)&&T!==-1;T--,q++)O+=256*C[T]>>>0,C[T]=O%o>>>0,O=O/o>>>0;if(O!==0)throw new Error("Non-zero carry");A=q,x++}for(var L=F-A;L!==F&&C[L]===0;)L++;for(var G=a.repeat(_);L<F;++L)G+=r.charAt(C[L]);return G}function p(w){if(typeof w!="string")throw new TypeError("Expected String");if(w.length===0)return new Uint8Array;var _=0;if(w[_]!==" "){for(var A=0,x=0;w[_]===a;)A++,_++;for(var k=(w.length-_)*c+1>>>0,F=new Uint8Array(k);w[_];){var C=e[w.charCodeAt(_)];if(C===255)return;for(var O=0,q=k-1;(C!==0||O<x)&&q!==-1;q--,O++)C+=o*F[q]>>>0,F[q]=C%256>>>0,C=C/256>>>0;if(C!==0)throw new Error("Non-zero carry");x=O,_++}if(w[_]!==" "){for(var T=k-x;T!==k&&F[T]===0;)T++;for(var L=new Uint8Array(A+(k-T)),G=A;T!==k;)L[G++]=F[T++];return L}}}function m(w){var _=p(w);if(_)return _;throw new Error("Non-base"+o+" character")}return{encode:h,decodeUnsafe:p,decode:m}}la.exports=ef});var Ht=g((Vd,fa)=>{u();"use strict";var tf=new TextDecoder,rf=r=>tf.decode(r),nf=new TextEncoder,sf=r=>nf.encode(r);function of(r,e){let t=new Uint8Array(e),n=0;for(let i of r)t.set(i,n),n+=i.length;return t}fa.exports={decodeText:rf,encodeText:sf,concat:of}});var ya=g((Jd,da)=>{u();"use strict";var{encodeText:af}=Ht(),pa=class{constructor(e,t,n,i){this.name=e,this.code=t,this.codeBuf=af(this.code),this.alphabet=i,this.codec=n(i)}encode(e){return this.codec.encode(e)}decode(e){for(let t of e)if(this.alphabet&&this.alphabet.indexOf(t)<0)throw new Error(`invalid character '${t}' in '${e}'`);return this.codec.decode(e)}};da.exports=pa});var wa=g((Qd,ga)=>{u();"use strict";var cf=(r,e,t)=>{let n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let i=r.length;for(;r[i-1]==="=";)--i;let s=new Uint8Array(i*t/8|0),o=0,a=0,c=0;for(let l=0;l<i;++l){let h=n[r[l]];if(h===void 0)throw new SyntaxError("Invalid character "+r[l]);a=a<<t|h,o+=t,o>=8&&(o-=8,s[c++]=255&a>>o)}if(o>=t||255&a<<8-o)throw new SyntaxError("Unexpected end of data");return s},uf=(r,e,t)=>{let n=e[e.length-1]==="=",i=(1<<t)-1,s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s},lf=r=>e=>({encode(t){return uf(t,e,r)},decode(t){return cf(t,e,r)}});ga.exports={rfc4648:lf}});var xa=g((Kd,_a)=>{u();"use strict";var yt=ha(),hf=ya(),{rfc4648:R}=wa(),{decodeText:ff,encodeText:pf}=Ht(),df=()=>({encode:ff,decode:pf}),ba=[["identity","\0",df,""],["base2","0",R(1),"01"],["base8","7",R(3),"01234567"],["base10","9",yt,"0123456789"],["base16","f",R(4),"0123456789abcdef"],["base16upper","F",R(4),"0123456789ABCDEF"],["base32hex","v",R(5),"0123456789abcdefghijklmnopqrstuv"],["base32hexupper","V",R(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV"],["base32hexpad","t",R(5),"0123456789abcdefghijklmnopqrstuv="],["base32hexpadupper","T",R(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV="],["base32","b",R(5),"abcdefghijklmnopqrstuvwxyz234567"],["base32upper","B",R(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"],["base32pad","c",R(5),"abcdefghijklmnopqrstuvwxyz234567="],["base32padupper","C",R(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567="],["base32z","h",R(5),"ybndrfg8ejkmcpqxot1uwisza345h769"],["base36","k",yt,"0123456789abcdefghijklmnopqrstuvwxyz"],["base36upper","K",yt,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"],["base58btc","z",yt,"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"],["base58flickr","Z",yt,"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"],["base64","m",R(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"],["base64pad","M",R(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="],["base64url","u",R(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"],["base64urlpad","U",R(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_="]],ma=ba.reduce((r,e)=>(r[e[0]]=new hf(e[0],e[1],e[2],e[3]),r),{}),yf=ba.reduce((r,e)=>(r[e[1]]=ma[e[0]],r),{});_a.exports={names:ma,codes:yf}});var Ea=g((ge,Ba)=>{u();"use strict";var Ye=xa(),{encodeText:gf,decodeText:$t,concat:va}=Ht();function wf(r,e){if(!e)throw new Error("requires an encoded Uint8Array");let{name:t,codeBuf:n}=Ie(r);return xf(t,e),va([n,e],n.length+e.length)}function bf(r,e){let t=Ie(r),n=gf(t.encode(e));return va([t.codeBuf,n],t.codeBuf.length+n.length)}function mf(r){r instanceof Uint8Array&&(r=$t(r));let e=r[0];return["f","F","v","V","t","T","b","B","c","C","h","k","K"].includes(e)&&(r=r.toLowerCase()),Ie(r[0]).decode(r.substring(1))}function _f(r){if(r instanceof Uint8Array&&(r=$t(r)),Object.prototype.toString.call(r)!=="[object String]")return!1;try{return Ie(r[0]).name}catch(e){return!1}}function xf(r,e){Ie(r).decode($t(e))}function Ie(r){if(Object.prototype.hasOwnProperty.call(Ye.names,r))return Ye.names[r];if(Object.prototype.hasOwnProperty.call(Ye.codes,r))return Ye.codes[r];throw new Error(`Unsupported encoding: ${r}`)}function vf(r){return r instanceof Uint8Array&&(r=$t(r)),Ie(r[0])}ge=Ba.exports=wf;ge.encode=bf;ge.decode=mf;ge.isEncoded=_f;ge.encoding=Ie;ge.encodingFromData=vf;var Bf=Object.freeze(Ye.names),Ef=Object.freeze(Ye.codes);ge.names=Bf;ge.codes=Ef});var Aa=g((Xd,ka)=>{u();"use strict";var{encoding:kf}=Ea(),Af=new TextDecoder("utf8");function Sf(r){let e="";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e}function Cf(r,e="utf8"){return e==="utf8"||e==="utf-8"?Af.decode(r):e==="ascii"?Sf(r):kf(e).encode(r)}ka.exports=Cf});var Ma=g((Zd,Oa)=>{u();"use strict";var{EventEmitter:Tf}=Wt(),Sa=Aa(),Ff=pt(),Of=_e().logger,Ca=r=>`unwant:${Sa(r.multihash.bytes,"base64")}`,Ta=r=>`block:${Sa(r.multihash.bytes,"base64")}`,Fa=class extends Tf{constructor(e){super();this.setMaxListeners(Ff.maxListeners),this._log=Of(e,"notif")}hasBlock(e,t){let n=Ta(e);this._log(n),this.emit(n,t)}wantBlock(e,t={}){if(!e)throw new Error("Not a valid cid");let n=Ta(e),i=Ca(e);return this._log(`wantBlock:${e}`),new Promise((s,o)=>{let a=()=>{this.removeListener(n,c),o(new Error(`Block for ${e} unwanted`))},c=l=>{this.removeListener(i,a),s(l)};this.once(i,a),this.once(n,c),t&&t.signal&&t.signal.addEventListener("abort",()=>{this.removeListener(n,c),this.removeListener(i,a),o(new Error(`Want for ${e} aborted`))})})}unwantBlock(e){let t=Ca(e);this._log(t),this.emit(t)}};Oa.exports=Fa});var Pa=g((La,Ia)=>{u();"use strict";var Mf=Math.exp;La=Ia.exports=function(e){if(typeof e!="number")throw new Error("must provide a timespan to the moving average constructor");if(e<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let t,n=0,i=0,s=0,o,a={};function c(l,h){return 1-Mf(-(l-h)/e)}return a.push=function(h,p){if(o){let m=c(h,o),w=p-t,_=m*w;t=m*p+(1-m)*t,n=(1-m)*(n+w*_),i=Math.sqrt(n),s=t+m*w}else t=p;o=h},a.movingAverage=function(){return t},a.variance=function(){return n},a.deviation=function(){return i},a.forecast=function(){return s},a}});var Ua=g((Yd,Na)=>{u();"use strict";var{EventEmitter:Lf}=Wt(),Da=Pa(),qa=class extends Lf{constructor(e,t){super();this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),e.forEach(n=>{this._stats[n]=BigInt(0),this._movingAverages[n]={},this._options.movingAverageIntervals.forEach(i=>{(this._movingAverages[n][i]=Da(i)).push(this._frequencyLastTime,0)})}),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._disabled=!0}stop(){this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){let e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=null,this._queue.length){let e;for(;this._queue.length;){let t=e=this._queue.shift();t&&this._applyOp(t)}e&&this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){let t=e-this._frequencyLastTime;t&&Object.keys(this._stats).forEach(n=>{this._updateFrequencyFor(n,t,e)}),this._frequencyLastTime=e}_updateFrequencyFor(e,t,n){let i=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;let s=i/t*1e3,o=this._movingAverages[e];o||(o=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach(a=>{let c=o[a];c||(c=o[a]=Da(a)),c.push(n,s)})}_applyOp(e){let t=e[0],n=e[1];if(typeof n!="number")throw new Error(`invalid increment number: ${n}`);Object.prototype.hasOwnProperty.call(this._stats,t)||(this._stats[t]=BigInt(0)),this._stats[t]=BigInt(this._stats[t])+BigInt(n),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=n}};Na.exports=qa});var Ha=g((e0,Wa)=>{u();"use strict";var{EventEmitter:If}=Wt(),Ra=Ua(),ja={enabled:!1,computeThrottleTimeout:1e3,computeThrottleMaxQueueSize:1e3,movingAverageIntervals:[60*1e3,5*60*1e3,15*60*1e3]},za=class extends If{constructor(e=[],t=ja){super();let n=Object.assign({},ja,t);if(typeof n.computeThrottleTimeout!="number")throw new Error("need computeThrottleTimeout");if(typeof n.computeThrottleMaxQueueSize!="number")throw new Error("need computeThrottleMaxQueueSize");this._initialCounters=e,this._options=n,this._enabled=this._options.enabled,this._global=new Ra(e,n),this._global.on("update",i=>this.emit("update",i)),this._peers=new Map}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(let e of this._peers)e[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(e){let t=typeof e!="string"&&e.toB58String?e.toB58String():`${e}`;return this._peers.get(t)}push(e,t,n){if(this._enabled&&(this._global.push(t,n),e)){let i=this._peers.get(e);i||(i=new Ra(this._initialCounters,this._options),this._peers.set(e,i)),i.push(t,n)}}disconnected(e){let t=e.toB58String(),n=this._peers.get(t);n&&(n.stop(),this._peers.delete(t))}};Wa.exports=za});var Ga=g((t0,Gt)=>{u();"use strict";var{AbortController:$a,AbortSignal:Pf}=typeof self!="undefined"?self:typeof window!="undefined"?window:void 0;Gt.exports=$a;Gt.exports.AbortSignal=Pf;Gt.exports.default=$a});var rn=g((r0,Va)=>{u();"use strict";var Vt;globalThis.AbortController&&globalThis.AbortSignal?Vt=globalThis:Vt=Ga();Va.exports={AbortController:Vt.AbortController,AbortSignal:Vt.AbortSignal}});var Qa=g((n0,nn)=>{u();var{AbortController:Df}=rn();function Ja(r){let e=new Df;function t(){e.abort();for(let n of r)!n||!n.removeEventListener||n.removeEventListener("abort",t)}for(let n of r)if(!(!n||!n.addEventListener)){if(n.aborted){t();break}n.addEventListener("abort",t)}return e.signal}nn.exports=Ja;nn.exports.anySignal=Ja});var Xa=g((i0,Ka)=>{u();"use strict";var qf=async r=>{for await(let e of r);};Ka.exports=qf});var Ya=g((s0,Za)=>{u();"use strict";var Nf=async function*(r,e){for await(let t of r)await e(t)&&(yield t)};Za.exports=Nf});var tc=g((o0,ec)=>{u();"use strict";var Uf=async function*(r,e){let t=0;if(!(e<1)){for await(let n of r)if(yield n,t++,t===e)return}};ec.exports=Uf});var nc=g((a0,rc)=>{u();"use strict";var Rf=async r=>{let e=[];for await(let t of r)e.push(t);return e};rc.exports=Rf});var sn=g((c0,cc)=>{u();"use strict";var ic=Xa(),et=Ya(),sc=tc(),jf=nc(),oc=(r,e)=>async function*(){yield*(await jf(r)).sort(e)}(),ac=class{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(let{key:n,value:i}of e)await this.put(n,i,t),yield{key:n,value:i}}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(let n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await ic(this.putMany(e,n)),e=[],await ic(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null&&(n=et(n,i=>i.key.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>et(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>oc(i,s),n)),e.offset!=null){let i=0;n=et(n,()=>i++>=(e.offset||0))}return e.limit!=null&&(n=sc(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null&&(n=et(n,i=>i.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>et(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>oc(i,s),n)),e.offset!=null){let i=0;n=et(n,()=>i++>=e.offset)}return e.limit!=null&&(n=sc(n,e.limit)),n}};cc.exports=ac});var lc={};X(lc,{code:()=>Wf,decode:()=>$f,encode:()=>Hf,name:()=>zf});var uc,zf,Wf,Hf,$f,hc=z(()=>{u();ze();uc=r=>fe(r),{name:zf,code:Wf,encode:Hf,decode:$f}={name:"raw",code:85,decode:uc,encode:uc}});var pc=g((l0,fc)=>{u();"use strict";var Gf=Pr();function Vf(r){return r=r||new Error("Not Found"),Gf(r,"ERR_NOT_FOUND")}fc.exports={notFoundError:Vf}});var mc=g((h0,bc)=>{u();"use strict";var Jf=sn(),{base32:tt}=(pr(),Wn),dc=(hc(),lc),{CID:yc}=(dr(),Gn),gc=(st(),vt),Qf=pc(),wc=class extends Jf{constructor(){super();this.data={}}open(){return Promise.resolve()}close(){return Promise.resolve()}async put(e,t){this.data[tt.encode(e.multihash.bytes)]=t}async get(e){if(!await this.has(e))throw Qf.notFoundError();return this.data[tt.encode(e.multihash.bytes)]}async has(e){return this.data[tt.encode(e.multihash.bytes)]!==void 0}async delete(e){delete this.data[tt.encode(e.multihash.bytes)]}async*_all(){yield*Object.entries(this.data).map(([e,t])=>({key:yc.createV1(dc.code,gc.decode(tt.decode(e))),value:t}))}async*_allKeys(){yield*Object.entries(this.data).map(([e])=>yc.createV1(dc.code,gc.decode(tt.decode(e))))}};bc.exports=wc});var xc=g((f0,_c)=>{u();"use strict";var Kf=sn(),Xf=mc();_c.exports={BlockstoreAdapter:Kf,MemoryBlockstore:Xf}});var Ec=g((p0,Bc)=>{u();"use strict";var Zf=qs(),Yf=Do(),ep=Yo(),tp=Ma(),rp=_e().logger,np=Ha(),{AbortController:ip}=rn(),{anySignal:sp}=Qa(),{BlockstoreAdapter:op}=xc(),{CID:ap}=(Tt(),Ct),cp={statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},up=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"],vc=class extends op{constructor(e,t,n={}){super();this._libp2p=e,this._log=rp(this.peerId),this._options=Object.assign({},cp,n),this._stats=new np(up,{enabled:this._options.statsEnabled,computeThrottleTimeout:this._options.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:this._options.statsComputeThrottleMaxQueueSize}),this.network=new Yf(e,this,this._stats,{hashers:n.hashers}),this.blockstore=t,this.engine=new ep(this.peerId,t,this.network,this._stats),this.wm=new Zf(this.peerId,this.network,this._stats),this.notifications=new tp(this.peerId),this.started=!1}isStarted(){return this.started}get peerId(){return this._libp2p.peerId}async _receiveMessage(e,t){try{await this.engine.messageReceived(e,t)}catch(i){this._log("failed to receive message",t)}if(t.blocks.size===0)return;let n=[];for(let[i,s]of t.blocks.entries()){let o=ap.parse(i);n.push({wasWanted:this.wm.wantlist.contains(o),cid:o,data:s})}this.wm.cancelWants(n.filter(({wasWanted:i})=>i).map(({cid:i})=>i)),await Promise.all(n.map(({cid:i,wasWanted:s,data:o})=>this._handleReceivedBlock(e,i,o,s)))}async _handleReceivedBlock(e,t,n,i){this._log("received block");let s=await this.blockstore.has(t);this._updateReceiveCounters(e.toB58String(),t,n,s),!!i&&await this.put(t,n)}_updateReceiveCounters(e,t,n,i){this._stats.push(e,"blocksReceived",1),this._stats.push(e,"dataReceived",n.length),i&&(this._stats.push(e,"dupBlksReceived",1),this._stats.push(e,"dupDataReceived",n.length))}_receiveError(e){this._log.error("ReceiveError: %s",e.message)}_onPeerConnected(e){this.wm.connected(e)}_onPeerDisconnected(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this._stats.disconnected(e)}enableStats(){this._stats.enable()}disableStats(){this._stats.disable()}wantlistForPeer(e,t){return this.engine.wantlistForPeer(e)}ledgerForPeer(e){return this.engine.ledgerForPeer(e)}async get(e,t={}){let n=(l,h)=>(this.wm.wantBlocks([l],h),this.notifications.wantBlock(l,h)),i=!1,s=async(l,h)=>{try{return await this.blockstore.get(l,h)}catch(p){if(p.code!=="ERR_NOT_FOUND")throw p;return i||(i=!0,this.network.findAndConnect(l).catch(m=>this._log.error(m))),n(l,h)}},o=new ip,a=t.signal?sp([t.signal,o.signal]):o.signal,c=await Promise.race([this.notifications.wantBlock(e,{signal:a}),s(e,{signal:a})]);return o.abort(),c}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}unwant(e){let t=Array.isArray(e)?e:[e];this.wm.unwantBlocks(t),t.forEach(n=>this.notifications.unwantBlock(n))}cancelWants(e){this.wm.cancelWants(Array.isArray(e)?e:[e])}async put(e,t,n){await this.blockstore.put(e,t),this._sendHaveBlockNotifications(e,t)}async*putMany(e,t){for await(let{key:n,value:i}of this.blockstore.putMany(e,t))this._sendHaveBlockNotifications(n,i),yield{key:n,value:i}}_sendHaveBlockNotifications(e,t){this.notifications.hasBlock(e,t),this.engine.receivedBlocks([{cid:e,data:t}]),this.network.provide(e).catch(n=>{this._log.error("Failed to provide: %s",n.message)})}getWantlist(){return this.wm.wantlist.entries()}peers(){return this.engine.peers()}stat(){return this._stats}start(){this.wm.start(),this.network.start(),this.engine.start(),this.started=!0}stop(){this._stats.stop(),this.wm.stop(),this.network.stop(),this.engine.stop(),this.started=!1}unwrap(){return this.blockstore}};Bc.exports=vc});var fp=g((d0,kc)=>{u();"use strict";var lp=Ec(),hp=(r,e,t={})=>new lp(r,e,t);kc.exports={createBitswap:hp}});return fp();})();
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
return IpfsBitswap}));
